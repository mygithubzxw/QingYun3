<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’äº‘ä¹‹å¿—3ç®—æé™å…³å¡</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/10.4.2/decimal.min.js"></script>
    <!-- Vercel Analytics -->
    <!-- Vercel åŸç”Ÿåˆ†æï¼ˆéƒ¨ç½²åè‡ªåŠ¨å·¥ä½œï¼‰ -->
    <script defer src="/_vercel/insights/script.js"></script>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        h1 {
            margin-bottom: 10px;
        }

        .description {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
        }

        .input-section {
            flex: 1;
            min-width: 300px;
            padding: 20px;
            border-right: 1px solid #eee;
        }

        .output-section {
            flex: 1;
            min-width: 300px;
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #444;
        }

        input,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
        }

        button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .result {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            border-left: 4px solid #2575fc;
        }

        .result h3 {
            color: #2575fc;
            margin-bottom: 10px;
        }

        .output-log {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            margin-top: 20px;
        }

        .output-line {
            margin-bottom: 5px;
        }

        .highlight {
            color: #f39c12;
            font-weight: bold;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .magnitude-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .magnitude-table th {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 12px 15px;
            text-align: center;
            font-weight: bold;
        }

        .magnitude-table td {
            padding: 10px 15px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }

        .magnitude-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .magnitude-table tr:hover {
            background-color: #e9ecef;
        }

        .table-container {
            margin-top: 20px;
        }

        .table-title {
            font-size: 18px;
            color: #2575fc;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .format-examples {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        /* æŠ¤èº«ç¬¦å¡ç‰‡æ ·å¼ */
        .talisman-card {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .talisman-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .talisman-title {
            font-weight: bold;
            color: #2575fc;
            font-size: 18px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #2575fc;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .talisman-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .talisman-form-group {
            margin-bottom: 10px;
        }

        .talisman-form-group label {
            font-size: 14px;
            margin-bottom: 3px;
            color: #666;
        }

        .talisman-form-group input,
        .talisman-form-group select {
            padding: 8px 10px;
            font-size: 14px;
        }

        /* è‡ªå®šä¹‰æŠ¤èº«ç¬¦æ ·å¼ */
        .custom-param-group {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .custom-param-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .custom-param-name {
            flex: 1;
            margin-right: 10px;
        }

        .remove-custom-param {
            background: #e74c3c;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .custom-param-inputs {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .custom-param-inputs label {
            margin-bottom: 0;
            white-space: nowrap;
        }

        .custom-param-inputs input {
            width: auto;
            flex: 1;
        }

        #addCustomParam {
            background: #27ae60;
            margin-top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-icon {
            font-size: 18px;
            font-weight: bold;
        }

        /* è‡ªå®šä¹‰ç­–ç•¥æ ·å¼ */
        .strategy-section {
            margin-top: 30px;
            border-top: 2px solid #eee;
            padding-top: 20px;
        }

        .strategy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .strategy-controls {
            display: flex;
            gap: 10px;
        }

        .strategy-btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        /* ç­–ç•¥é˜¶æ®µæ ·å¼ - ä¿®æ”¹è¾¹æ¡†æ ·å¼ */
        .strategy-stage {
            background-color: #f8f9fa;
            border: 2px solid #2575fc; /* å¢åŠ è¾¹æ¡†å®½åº¦ï¼Œä½¿ç”¨ä¸»é¢˜è“è‰² */
            border-radius: 10px; /* å¢åŠ åœ†è§’ */
            padding: 15px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* æ·»åŠ é˜´å½±æ•ˆæœ */
            transition: all 0.3s ease; /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */
        }

        /* é¼ æ ‡æ‚¬åœæ—¶å¢å¼ºè¾¹æ¡†æ•ˆæœ */
        .strategy-stage:hover {
            border-color: #6a11cb; /* æ‚¬åœæ—¶ä½¿ç”¨æ¸å˜ä¸­çš„æ·±è‰² */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); /* å¢å¼ºé˜´å½± */
            transform: translateY(-2px); /* è½»å¾®ä¸Šæµ®æ•ˆæœ */
        }

        /* æ”¶èµ·çŠ¶æ€ä¸‹çš„æ ·å¼ */
        .strategy-stage.collapsed {
            border-color: #ddd; /* æ”¶èµ·æ—¶ä½¿ç”¨è¾ƒæµ…çš„è¾¹æ¡†è‰² */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); /* æ”¶èµ·æ—¶å‡å°‘é˜´å½± */
        }

        /* é˜¶æ®µå¤´éƒ¨æ ·å¼ - ä¸è¾¹æ¡†åè°ƒ */
        .stage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        /* é˜¶æ®µæ ‡é¢˜æ ·å¼ */
        .stage-title {
            font-weight: bold;
            color: #2575fc;
            font-size: 18px;
        }

        /* åˆ é™¤æŒ‰é’®æ ·å¼ */
        .remove-stage {
            background: #e74c3c;
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .remove-stage:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        /* é˜¶æ®µå†…å®¹æ ·å¼ */
        .stage-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        /* æŠ¤èº«ç¬¦å¡ç‰‡æ ·å¼ - ä¸é˜¶æ®µè¾¹æ¡†åè°ƒ */
        .strategy-stage .talisman-card {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        /* é˜¶æ®µè¡¨å•ç»„æ ·å¼ */
        .strategy-stage .stage-form-group {
            margin-bottom: 8px;
        }

        .strategy-stage .stage-form-group label {
            font-size: 12px;
            margin-bottom: 3px;
            color: #666;
        }

        .strategy-stage .stage-form-group input,
        .strategy-stage .stage-form-group select {
            padding: 6px 8px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* åŸºç¡€ç•ªæ•°å’ŒåŸºç¡€åˆ†æ•°ç»„æ ·å¼ */
        .strategy-stage .basic-fan-group,
        .strategy-stage .basic-score-group {
            grid-column: span 1;
        }

        /* è‡ªå®šä¹‰æŠ¤èº«ç¬¦å®¹å™¨æ ·å¼ */
        .strategy-stage .stage-custom-params-container {
            margin-top: 10px;
            width: 100%;
            box-sizing: border-box;
            padding: 4px 0;
        }

        .stage-form-group {
            margin-bottom: 8px;
        }

        .stage-form-group label {
            font-size: 12px;
            margin-bottom: 3px;
            color: #666;
        }

        .stage-form-group input,
        .stage-form-group select {
            padding: 6px 8px;
            font-size: 14px;
        }

        .strategy-presets {
            margin-top: 15px;
        }

        .preset-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .preset-btn {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        /* å®é™…å¼€å§‹å…³å¡è¾“å…¥æ¡†æ ·å¼ */
        .actual-level-input {
            width: 80px;
            margin-left: 10px;
        }

        /* æç¤ºä¿¡æ¯æ ·å¼ */
        .tooltip-container {
            position: relative;
            display: inline-block;
            margin-left: 8px;
        }

        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background-color: #fff;
            color: #2575fc;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            transition: all 0.3s;
            box-shadow: 0 0 0 1px #2575fc;
        }

        .tooltip-icon:hover {
            background-color: #2575fc;
            color: white;
        }

        .tooltip-text {
            visibility: hidden;
            width: 350px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.4;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* æ–°å¢çš„é˜¶æ®µè‡ªå®šä¹‰æŠ¤èº«ç¬¦æ ·å¼ */
        .stage-custom-param-group {
            background-color: #f8f9fa;
            padding: 10px 12px;
            /* å¢åŠ å†…è¾¹è·ï¼Œè®©å†…éƒ¨å…ƒç´ ä¸æ‹¥æŒ¤ */
            border-radius: 4px;
            margin-bottom: 8px;
            /* æ¯ä¸ªå®¹å™¨ä¹‹é—´ç•™é—´è· */
            border: 1px solid #e0e0e0;
            display: flex;
            /* ç”¨ flex å¸ƒå±€ç¡®ä¿å…ƒç´ æ¨ªå‘æ’åˆ— */
            align-items: center;
            /* å‚ç›´å±…ä¸­å†…éƒ¨å…ƒç´  */
            width: 100%;
            /* å æ»¡å¤–å±‚å®¹å™¨å®½åº¦ */
            box-sizing: border-box;
            /* ç¡®ä¿ padding ä¸å½±å“å®½åº¦ */
            gap: 12px;
            /* å¢åŠ å†…éƒ¨å…ƒç´ é—´è·ï¼Œé¿å…æŒ¤å‹ */
            flex-wrap: nowrap;
            /* PCç«¯å¼ºåˆ¶ä¸æ¢è¡Œï¼Œç¡®ä¿ä¸€è¡Œæ˜¾ç¤ºå®Œæ•´ */
        }


        .stage-custom-param-inputs {
            display: flex;
            align-items: center;
            gap: 12px;
            /* è¾“å…¥æ¡†ä¹‹é—´ç•™è¶³é—´è· */
            flex: 1;
            /* å æ®å®¹å™¨å‰©ä½™æ‰€æœ‰ç©ºé—´ï¼Œç¡®ä¿èƒ½åŒ…è£¹è¾“å…¥æ¡† */
            flex-wrap: nowrap;
            /* å¼ºåˆ¶ä¸æ¢è¡Œ */
        }

        .stage-custom-param-inputs input {
            padding: 6px 8px;
            font-size: 14px;
            box-sizing: border-box;
            flex-shrink: 0;
            /* é˜²æ­¢è¾“å…¥æ¡†è¢«å‹ç¼© */
        }

        .stage-custom-param-inputs .stage-custom-param-name {
            width: 140px;
            /* åç§°è¾“å…¥æ¡†å›ºå®šå®½åº¦ï¼Œè¶³å¤Ÿæ˜¾ç¤ºâ€œè‡ªå®šä¹‰æŠ¤èº«ç¬¦Xâ€ */
            min-width: 140px;
            /* PCç«¯ä¸å…è®¸ç¼©å° */
        }

        .stage-custom-param-inputs .stage-custom-param-value {
            width: 100px;
            /* å€æ•°è¾“å…¥æ¡†å®½åº¦ */
            min-width: 100px;
        }

        .stage-custom-param-inputs .stage-custom-param-times {
            width: 80px;
            /* æ¬¡æ•°è¾“å…¥æ¡†å®½åº¦ */
            min-width: 80px;
        }

        .stage-custom-param-inputs label {
            margin-bottom: 0;
            white-space: nowrap;
            font-size: 12px;
            flex-shrink: 0;
        }

        /* åˆ é™¤æŒ‰é’®æ ·å¼ - ç¡®ä¿åœ¨æœ€å³ä¾§ */
        .stage-remove-custom-param {
            background: #e74c3c;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            flex-shrink: 0;
            /* é˜²æ­¢æŒ‰é’®è¢«å‹ç¼© */
            margin-left: auto;
            /* å…³é”®ï¼šå°†æŒ‰é’®æ¨åˆ°æœ€å³ä¾§ */
        }

        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }

            .input-section {
                border-right: none;
                border-bottom: 1px solid #eee;
            }

            .custom-param-inputs {
                flex-direction: column;
                align-items: flex-start;
            }

            .custom-param-inputs input {
                width: 100%;
            }

            .stage-content {
                grid-template-columns: 1fr;
            }

            .actual-level-input {
                width: 100%;
                margin-left: 0;
                margin-top: 5px;
            }

            .stage-custom-param-inputs {
                flex-direction: column;
                align-items: flex-start;
            }

            .stage-custom-param-inputs input {
                width: 100%;
            }

            .talisman-content {
                grid-template-columns: 1fr;
            }

            .stage-custom-param-group {
                overflow-x: auto;
                /* å…è®¸æ°´å¹³æ»šåŠ¨ */
                padding: 8px;
            }

            .stage-custom-param-inputs {
                flex-wrap: nowrap;
                /* ç¦æ­¢æ¢è¡Œ */
            }

            .stage-custom-param-inputs input {
                min-width: 80px;
                /* ç§»åŠ¨ç«¯æœ€å°å®½åº¦ */
            }

            .stage-custom-param-group {
                gap: 15px;
                /* PCç«¯å¢åŠ é—´è·ï¼Œæ›´ç¾è§‚ */
            }

            .stage-custom-param-inputs {
                gap: 15px;
            }

            /* ç¡®ä¿åŸºç¡€ç•ªæ•°/åˆ†æ•°ä¸æŠ¤èº«ç¬¦å¡ç‰‡å¸ƒå±€åè°ƒ */
            .stage-form-group.basic-fan-group,
            .stage-form-group.basic-score-group {
                grid-column: span 1;
                /* PCç«¯è®©åŸºç¡€ç•ªæ•°/åˆ†æ•°å¹¶æ’æ˜¾ç¤º */
                max-width: none;
                /* å–æ¶ˆå®½åº¦é™åˆ¶ï¼Œé¿å…æŒ¤å‹ */
            }

            .strategy-stage {
                border-width: 2px; /* ä¿æŒè¾¹æ¡†å®½åº¦ */
                padding: 12px; /* ç¨å¾®å‡å°‘å†…è¾¹è· */
                margin-bottom: 15px;
            }

            .stage-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .stage-controls {
                align-self: flex-end;
            }
        }

        .stage-custom-params-container {
            margin-top: 10px;
            width: 100%;
            /* ç¡®ä¿å®¹å™¨å æ»¡çˆ¶å…ƒç´ å®½åº¦ */
            box-sizing: border-box;
            /* é¿å… padding æ’‘å¤§å®¹å™¨ */
            padding: 4px 0;
            /* ä¸Šä¸‹ç•™å°‘é‡å†…è¾¹è·ï¼Œé¿å…å…ƒç´ è´´è¾¹ */
        }

        .add-stage-custom-param-btn {
            background: #27ae60;
            margin-top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            padding: 6px 10px;
            font-size: 12px;
            width: auto;
        }

        .stage-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        /* ç¡®ä¿åŸºç¡€ç•ªæ•°å’ŒåŸºç¡€åˆ†æ•°åœ¨æŠ¤èº«ç¬¦å¡ç‰‡ä¹‹åå•ç‹¬æˆè¡Œ */
        .stage-form-group[style*="grid-column"] {
            grid-column: 1 / -1;
        }

        /* ä¸ºæŠ¤èº«ç¬¦å¡ç‰‡è®¾ç½®ç‰¹å®šçš„ç½‘æ ¼åˆ—è·¨åº¦ */
        .talisman-card {
            grid-column: 1 / -1;
        }

        /* ç¡®ä¿åŸºç¡€ç•ªæ•°å’ŒåŸºç¡€åˆ†æ•°åœ¨æŠ¤èº«ç¬¦å¡ç‰‡ä¹‹åæ˜¾ç¤º */
        .stage-form-group:not(.talisman-card) {
            grid-column: span 1;
        }

        /* åœ¨PCç«¯ï¼Œè®©åŸºç¡€ç•ªæ•°å’ŒåŸºç¡€åˆ†æ•°å¹¶æ’æ˜¾ç¤º */
        @media (min-width: 769px) {

            .stage-form-group.basic-fan-group,
            .stage-form-group.basic-score-group {
                grid-column: span 1;
            }

            /* ç¡®ä¿åœ¨æŠ¤èº«ç¬¦å¡ç‰‡ä¹‹åçš„åŸºç¡€å‚æ•°æ­£ç¡®æ’åˆ— */
            .stage-content > .stage-form-group:not(.talisman-card) {
                max-width: 200px;
            }
        }

        /* çœ¼ç›å›¾æ ‡æ ·å¼ */
        .toggle-eye {
            cursor: pointer;
            margin-left: 10px;
            font-size: 18px;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .toggle-eye.open {
            opacity: 1;
        }

        .toggle-eye.closed {
            opacity: 0.5;
        }

        /* è¡¨æ ¼éšè—æ—¶çš„æ ·å¼ */
        .magnitude-table.hidden {
            display: none;
        }

        /* æŠ¤èº«ç¬¦å†…å®¹éšè—æ ·å¼ */
        .talisman-content.hidden {
            display: none;
        }

        /* å…³å¡åˆ†æ•°å¯¹ç…§è¡¨å®¹å™¨æ ·å¼ */
        .score-table-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }

        /* è¡¨æ ¼éšè—æ ·å¼ */
        .score-table-container.hidden {
            display: none;
        }

        /* å•ä½è½¬æ¢å™¨æ ·å¼ */
        .unit-converter-container {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            margin-top: 10px;
        }

        .unit-converter-container.hidden {
            display: none;
        }

        .unit-converter-container .form-group {
            margin-bottom: 15px;
        }

        .unit-converter-container input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .unit-converter-container button {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }

        .unit-converter-container button:hover {
            opacity: 0.9;
        }

        .unit-converter-container .result {
            background-color: #e8f4fd;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            border-left: 4px solid #2575fc;
        }

        .unit-converter-container .result h3 {
            color: #2575fc;
            margin: 0;
            font-size: 16px;
        }

        /* é’äº‘ä¹‹å¿—å¿«æ·é”®æ¨¡å—æ ·å¼ */
        .shortcut-module-container {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            margin-top: 10px;
        }

        .shortcut-module-container.hidden {
            display: none;
        }

        .shortcut-content h3 {
            color: #2575fc;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .shortcut-content p {
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .download-info {
            background-color: #e8f4fd;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #2575fc;
        }

        .download-link {
            margin: 10px 0;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .download-link a {
            color: #2575fc;
            text-decoration: none;
            word-break: break-all;
            margin-left: 5px;
        }

        .download-link a:hover {
            text-decoration: underline;
        }

        .password-info {
            margin: 10px 0;
            font-size: 16px;
        }

        .shortcut-features {
            margin-top: 15px;
        }

        .shortcut-features h4 {
            color: #444;
            margin-bottom: 10px;
        }

        .shortcut-features ul {
            padding-left: 20px;
        }

        .shortcut-features li {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        /* é˜¶æ®µæ§åˆ¶æŒ‰é’®æ ·å¼ */
        .stage-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* æ”¶èµ·/å±•å¼€å›¾æ ‡æ ·å¼ */
        .toggle-stage-icon {
            cursor: pointer;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            background-color: #f0f0f0;
            color: #333;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            user-select: none;
        }

        .toggle-stage-icon:hover {
            background-color: #e0e0e0;
        }

        .toggle-stage-icon.open {
            background-color: #2575fc;
            color: white;
        }

        .toggle-stage-icon.closed {
            background-color: #f0f0f0;
            color: #666;
        }

        /* é˜¶æ®µå†…å®¹æ”¶èµ·çŠ¶æ€ */
        .stage-content.collapsed {
            display: none;
        }

        /* è¾“å…¥å‚æ•°å¤´éƒ¨æ ·å¼ */
        .input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .input-header h2 {
            margin-bottom: 0;
            flex: 1;
        }

        /* æ”¶èµ·/å±•å¼€å›¾æ ‡æ ·å¼ */
        .toggle-input-icon {
            cursor: pointer;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            background-color: #f0f0f0;
            color: #333;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            user-select: none;
            margin-left: 10px;
        }

        .toggle-input-icon:hover {
            background-color: #e0e0e0;
        }

        .toggle-input-icon.open {
            background-color: #2575fc;
            color: white;
        }

        .toggle-input-icon.closed {
            background-color: #f0f0f0;
            color: #666;
        }

        /* è¾“å…¥å‚æ•°å†…å®¹æ”¶èµ·çŠ¶æ€ */
        .input-content.collapsed {
            display: none;
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>é’äº‘ä¹‹å¿—3ç®—æé™å…³å¡</h1>
        <p class="description">
            æ ¹æ®å½“å‰èµ„æºçŠ¶æ€è®¡ç®—å…³å¡æ¨è¿›æé™ï¼Œæ”¯æŒå¤šé˜¶æ®µè‡ªå®šä¹‰ç­–ç•¥
            <span class="tooltip-container">
						<span class="tooltip-icon">â“˜</span>
						<span class="tooltip-text">æ­¤è®¡ç®—å™¨ä½¿ç”¨é—¨æ§›ä¸ºçŸ¥é“è†¨èƒ€è½¬ä¼ å¯¼ç©æ³•ï¼æ”¯æŒå¤šé˜¶æ®µç­–ç•¥é…ç½®</span>
					</span>
        </p>
    </header>

    <div class="content">
        <div class="input-section">
            <div class="input-header">
                <h2>è¾“å…¥å‚æ•°
                    <span class="tooltip-container">
                <span class="tooltip-icon">â“˜</span>
                <span class="tooltip-text">å•†åº—é˜¶æ®µ</span>
            </span>
                </h2>
                <span class="toggle-input-icon open" title="æ”¶èµ·è¾“å…¥å‚æ•°">âˆ’</span>
            </div>
            <div class="input-content">
                <div class="form-group">
                    <label for="curLevel">å½“å‰å…³å¡EX</label>
                    <input type="number" id="curLevel" value="1" min="1" max="163">
                </div>

                <!-- ç›—å°æŠ¤èº«ç¬¦å¡ç‰‡ -->
                <div class="talisman-card" id="dyTalismanCard">
                    <div class="talisman-header">
                        <div class="talisman-title">æŠ¤èº«ç¬¦ - ç›—å°</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="dyTalismanEnabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="talisman-content">
                        <div class="talisman-form-group">
                            <label for="dy">
                                ç›—å°ç•ªæ•°
                                <span class="tooltip-container">
										<span class="tooltip-icon">â“˜</span>
										<span class="tooltip-text">æ”¯æŒæ ¼å¼ï¼šæ•°å­—(396.87)ã€ç§‘å­¦è®¡æ•°æ³•(3.9687e34)ã€å•ä½(396.87æ²Ÿ)</span>
									</span>
                            </label>
                            <input type="text" id="dy" value="144.61">
                        </div>
                        <div class="talisman-form-group">
                            <label for="dy_type">
                                ç›—å°ç±»å‹
                                <span class="tooltip-container">
										<span class="tooltip-icon">â“˜</span>
										<span class="tooltip-text">
                                            è†¨èƒ€ç›—å°åŠ è†¨èƒ€è´Ÿé‡åŠ é»‘å®¢çš„ç©æ³•ä¸­ï¼Œå› ä¸ºé»‘å®¢éšæœºå˜åŒ–ï¼Œç®—ä¸å‡ºæ¥ç›—å°çš„æˆé•¿ï¼Œé»‘å®¢å˜ä¸€æ¬¡ç›—å°ï¼Œç›¸å½“äºåƒä¸€æ¬¡è¿·é›¾ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ¢ç®—æˆåƒè¿·é›¾æ¬¡æ•°ï¼Œ
                                            æœ€ä½³å®è·µï¼šåœ¨EX45è¾“å…¥å‚æ•°è®¡ç®—ï¼Œå°±èƒ½çŸ¥é“å“ªä¸€å…³æ‰¾å²šæ˜Ÿï¼Œå“ªä¸€å…³åˆ·ä¼ å¯¼å¡ç»´ï¼Œå†ç”¨åƒè¿·é›¾æ¬¡æ•°ä¿®æ­£æ•°æ®
                                        </span>
                            </span>
                            </label>
                            <select id="dy_type">
                                <option value="å¡ç»´è†¨èƒ€ç›—å°">å¡ç»´è†¨èƒ€ç›—å°1.3^4</option>
                                <option value="å…¶ä»–å¡è†¨èƒ€ç›—å°">å…¶ä»–å¡è†¨èƒ€ç›—å°1.3^2</option>
                                <option value="æ™®é€šç›—å°">æ™®é€šç›—å°1.3</option>
                                <option value="é»‘å®¢åªå˜ç›—å°">é»‘å®¢åªå˜ç›—å°1.3^6</option>
                            </select>
                        </div>
                        <div class="talisman-form-group">
                            <label for="dy_times">ç›—å°æ¬¡æ•°</label>
                            <input type="number" id="dy_times" value="2" min="0">
                        </div>
                        <div class="talisman-form-group">
                            <label for="eat_fog">
                                åƒè¿·é›¾æ¬¡æ•°
                                <span class="tooltip-container">
										<span class="tooltip-icon">â“˜</span>
										<span class="tooltip-text">åƒè¿·é›¾å’Œåƒæˆé•¿å°ç« å¯¹ç›—å°æ•ˆæœä¸€æ ·ï¼Œç»Ÿä¸€æˆåƒè¿·é›¾æ¬¡æ•°</span>
                            </span>
                            </label>
                            <input type="number" id="eat_fog" value="0" min="0">
                        </div>
                    </div>
                </div>

                <!-- è´Ÿé‡æŠ¤èº«ç¬¦å¡ç‰‡ -->
                <div class="talisman-card" id="fzTalismanCard">
                    <div class="talisman-header">
                        <div class="talisman-title">æŠ¤èº«ç¬¦ - è´Ÿé‡</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="fzTalismanEnabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="talisman-content">
                        <div class="talisman-form-group">
                            <label for="fz">è´Ÿé‡ç•ªæ•°</label>
                            <input type="text" id="fz" value="378.36">
                        </div>
                        <div class="talisman-form-group">
                            <label for="fz_type">è´Ÿé‡ç±»å‹</label>
                            <select id="fz_type">
                                <option value="è†¨èƒ€è´Ÿé‡">è†¨èƒ€è´Ÿé‡</option>
                                <option value="å¤©ä½¿è´Ÿé‡">å¤©ä½¿è´Ÿé‡</option>
                                <option value="æ™®é€šè´Ÿé‡">æ™®é€šè´Ÿé‡</option>
                            </select>
                        </div>
                        <div class="talisman-form-group">
                            <label for="fz_times">è´Ÿé‡æ¬¡æ•°</label>
                            <input type="number" id="fz_times" value="2" min="0">
                        </div>
                        <div class="talisman-form-group">
                            <label for="lose_fz">äºè´Ÿé‡æ¬¡æ•°</label>
                            <input type="number" id="lose_fz" value="0" min="0">
                        </div>
                    </div>
                </div>

                <!-- æœˆå…‰æŠ¤èº«ç¬¦å¡ç‰‡ -->
                <div class="talisman-card" id="ygTalismanCard">
                    <div class="talisman-header">
                        <div class="talisman-title">æŠ¤èº«ç¬¦ - æœˆå…‰</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="ygTalismanEnabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="talisman-content">
                        <div class="talisman-form-group">
                            <label for="yg">æœˆå…‰ç•ªæ•°</label>
                            <input type="text" id="yg" value="56.02">
                        </div>
                        <div class="talisman-form-group">
                            <label for="yg_type">æœˆå…‰ç±»å‹</label>
                            <select id="yg_type">
                                <option value="æ™®é€šæœˆå…‰">æ™®é€šæœˆå…‰</option>
                                <option value="è†¨èƒ€æœˆå…‰">è†¨èƒ€æœˆå…‰</option>
                                <option value="å¤©ä½¿æœˆå…‰">å¤©ä½¿æœˆå…‰</option>
                            </select>
                        </div>
                        <div class="talisman-form-group">
                            <label for="yg_times">æœˆå…‰æ¬¡æ•°</label>
                            <input type="number" id="yg_times" value="1" min="0">
                        </div>
                        <div class="talisman-form-group">
                            <label for="lose_yg">äºæœˆå…‰æ¬¡æ•°</label>
                            <input type="number" id="lose_yg" value="0" min="0">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="basicFan">åŸºç¡€ç•ªæ•°</label>
                    <input type="number" id="basicFan" value="19" min="1">
                </div>

                <div class="form-group">
                    <label for="basicScore">åŸºç¡€åˆ†æ•°</label>
                    <input type="number" id="basicScore" value="38" min="1">
                </div>

                <button id="addCustomParam">
                    <span class="add-icon">+</span> æ·»åŠ è‡ªå®šä¹‰æŠ¤èº«ç¬¦
                </button>

                <div id="customParamsContainer">
                    <!-- è‡ªå®šä¹‰æŠ¤èº«ç¬¦å°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
                </div>

                <button id="calculateBtn">è®¡ç®—å…³å¡æé™</button>
            </div>

            <!-- è‡ªå®šä¹‰ç­–ç•¥éƒ¨åˆ† -->
            <div class="strategy-section">
                <div class="strategy-header">
                    <h2>è‡ªå®šä¹‰ç­–ç•¥
                        <span class="tooltip-container">
									<span class="tooltip-icon">â“˜</span>
									<span class="tooltip-text">1.æ”¯æŒä»ä»»æ„é˜¶æ®µå¼€å§‹è‡ªå®šä¹‰ç­–ç•¥<br/>
										2.ç¬¬ä¸€ä¸ªé˜¶æ®µé»˜è®¤åŒæ­¥ä¸Šé¢çš„å‚æ•°<br/>
										3.ä¸è€ƒè™‘æ ‡å‡†é…ç½®çš„æŠ¤èº«ç¬¦ä¹‹å¤–å…¶ä»–æŠ¤èº«ç¬¦çš„å½±å“<br/>
										4.æ¯ä¸ªé˜¶æ®µé»˜è®¤ä»¥æé™å…³å¡è½¬ä¸‹ä¸€é˜¶æ®µï¼Œéœ€è¦è‡ªå·±æ ¹æ®å®é™…æƒ…å†µå¡«ä¸‹ä¸€é˜¶æ®µçš„å®é™…å¼€å§‹å…³å¡<br/>
										5.ä¸¤è†¨èƒ€+1æ™®é€š/1å¤©ä½¿ç©æ³•ä¸­ï¼Œå¦‚æœä»¥æ”¹ä¼ å¯¼å¡ç»´ä½œä¸ºå¼€å§‹é˜¶æ®µï¼Œä¸‹ä¸€ä¸ªæ”¹å²šæ˜Ÿé˜¶æ®µçš„å®é™…å¼€å§‹å…³å¡éœ€è¦è‡ªå·±å¡«ï¼Œå¦åˆ™è®¤ä¸ºæ²¡æ”¹å‡ºä¼ å¯¼å¡ç»´Gäº†
									</span>
								</span>
                    </h2>
                    <div class="strategy-controls">
                        <button class="strategy-btn" id="addStageBtn">+ æ·»åŠ é˜¶æ®µ</button>
                    </div>
                </div>

                <div id="strategyStagesContainer">
                    <!-- ç­–ç•¥é˜¶æ®µå°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
                </div>

                <div class="strategy-presets">
                    <h3>é¢„è®¾ç­–ç•¥</h3>
                    <div class="preset-buttons">
                        <button class="preset-btn" data-preset="standard" id="twoInflationBtn">
                            è†¨èƒ€ç›—å°è†¨èƒ€è´Ÿé‡æ™®é€šæœˆå…‰
                        </button>
                        <button class="preset-btn" data-preset="singleDyHacker" id="singleDyHackerBtn">å•ç›—å°é»‘å®¢
                        </button>
                        <button class="preset-btn" data-preset="inflationDyFzHacker" id="inflationDyFzHackerBtn">
                            è†¨èƒ€ç›—å°è†¨èƒ€è´Ÿé‡é»‘å®¢
                        </button>
                    </div>
                </div>
            </div>

            <button id="calculateStrategyBtn"
                    style="background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%);">æ‰§è¡Œç­–ç•¥è®¡ç®—
            </button>
        </div>

        <div class="output-section">
            <h2>è®¡ç®—ç»“æœ</h2>

            <!-- æ•°é‡çº§å¯¹ç…§è¡¨ -->
            <div class="table-container">
                <div class="table-title">
                    æ•°é‡çº§å¯¹ç…§è¡¨
                    <span class="toggle-eye open" id="toggleMagnitudeTable" title="ç‚¹å‡»éšè—è¡¨æ ¼">ğŸ‘ï¸</span>
                </div>
                <table class="magnitude-table" id="magnitudeTable">
                    <thead>
                    <tr>
                        <th>å•ä½</th>
                        <th>æ•°é‡çº§</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>ä¸‡</td>
                        <td>4</td>
                    </tr>
                    <tr>
                        <td>äº¿</td>
                        <td>8</td>
                    </tr>
                    <tr>
                        <td>å…†</td>
                        <td>12</td>
                    </tr>
                    <tr>
                        <td>äº¬</td>
                        <td>16</td>
                    </tr>
                    <tr>
                        <td>å“</td>
                        <td>20</td>
                    </tr>
                    <tr>
                        <td>ç§­</td>
                        <td>24</td>
                    </tr>
                    <tr>
                        <td>ç©°</td>
                        <td>28</td>
                    </tr>
                    <tr>
                        <td>æ²Ÿ</td>
                        <td>32</td>
                    </tr>
                    <tr>
                        <td>æ¶§</td>
                        <td>36</td>
                    </tr>
                    <tr>
                        <td>æ­£</td>
                        <td>40</td>
                    </tr>
                    <tr>
                        <td>è½½</td>
                        <td>44</td>
                    </tr>
                    <tr>
                        <td>æ</td>
                        <td>48</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <!-- å…³å¡åˆ†æ•°å¯¹ç…§è¡¨ -->
            <div class="table-container">
                <div class="table-title">
                    å…³å¡åˆ†æ•°å¯¹ç…§è¡¨
                    <span class="toggle-eye closed" id="toggleScoreTable" title="ç‚¹å‡»æ˜¾ç¤ºè¡¨æ ¼">ğŸ™ˆ</span>
                </div>
                <div class="score-table-container hidden">
                    <table class="magnitude-table" id="scoreTable">
                        <thead>
                        <tr>
                            <th>å…³å¡</th>
                            <th>åˆ†æ•°</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- å•ä½è½¬æ¢ç§‘å­¦è®¡æ•°æ³• -->
            <div class="table-container">
                <div class="table-title">
                    å•ä½è½¬æ¢ç§‘å­¦è®¡æ•°æ³•
                    <span class="toggle-eye closed" id="toggleUnitConverter" title="ç‚¹å‡»æ˜¾ç¤ºè½¬æ¢å™¨">ğŸ™ˆ</span>
                </div>
                <div class="unit-converter-container hidden">
                    <div class="form-group">
                        <label for="unitInput">å•ä½è¾“å…¥</label>
                        <input type="text" id="unitInput" placeholder="ä¾‹å¦‚ï¼š117.99æ¶§æææææ">
                    </div>
                    <div class="result">
                        <h3>è½¬æ¢ç»“æœï¼š<span id="conversionResult">ç­‰å¾…è¾“å…¥...</span></h3>
                    </div>
                    <button id="convertUnitBtn">å•ä½è½¬æ¢</button>
                </div>
            </div>

            <!-- é’äº‘ä¹‹å¿—å¿«æ·é”®æ¨¡å— -->
            <div class="table-container">
                <div class="table-title">
                    é’äº‘ä¹‹å¿—å¿«æ·é”®
                    <span class="toggle-eye closed" id="toggleShortcutModule" title="ç‚¹å‡»æ˜¾ç¤ºå¿«æ·é”®ä¿¡æ¯">ğŸ™ˆ</span>
                </div>
                <div class="shortcut-module-container hidden">
                    <div class="shortcut-content">
                        <h3>æ¸¸æˆå¿«æ·é”®è„šæœ¬</h3>
                        <p>ä¸ºè§£å†³åœ¨å•†åº—ä¹°å–æŠ¤èº«ç¬¦æ—¶éœ€è¦å¤§é‡ç§»åŠ¨å’Œç‚¹å‡»é¼ æ ‡ï¼Œå¯¹å³æ‰‹äº§ç”Ÿè¿‡é‡è´Ÿæ‹…å’Œæ“ä½œä¸ä¾¿çš„é—®é¢˜ï¼Œåˆ¶ä½œäº†ä¸€ä¸ªå¿«æ·é”®è„šæœ¬</p>
                        <div class="download-info">
                            <p><strong>ä¸‹è½½åœ°å€ï¼š</strong></p>
                            <div class="download-link">
                                <span>ç½‘ç›˜ï¼š</span>
                                <a href="https://wwmc.lanzoue.com/iOY1039q7tyj" target="_blank">https://wwmc.lanzoue.com/iOY1039q7tyj</a>
                            </div>
                            <div class="password-info">
                                <span>å¯†ç ï¼š<strong>emya</strong></span>
                            </div>
                        </div>
                        <div class="shortcut-features">
                            <h4>åŠŸèƒ½ç‰¹ç‚¹ï¼š</h4>
                            <ul>
                                <li>å‡å°‘é‡å¤é¼ æ ‡æ“ä½œ</li>
                                <li>é™ä½å³æ‰‹è´Ÿæ‹…</li>
                                <li>æå‡æ¸¸æˆæ•ˆç‡</li>
                                <li>ç®€åŒ–å•†åº—å¼€åŒ…æµç¨‹</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="result">
                <h3>
                    <span class="tooltip-container">
                        <span class="tooltip-icon">â“˜</span>
                        <span class="tooltip-text">æ§åˆ¶å°æ—¥å¿—è¯´æ˜ï¼š<br/>
                            1.æ¯ä¸€å…³ï¼Œç›—å°ç•ªæ•°æ˜¾ç¤ºå’Œå•†åº—å‚æ•°ä¸€è‡´ï¼Œå› ä¸ºç›—å°æˆé•¿å°±ä»£è¡¨åˆ°ä¸‹ä¸€å…³äº†;è´Ÿé‡å’Œæœˆå…‰æ˜¯å…³å¡å†…æˆé•¿ï¼Œæ ¹æ®é…ç½®çš„ç±»å‹å’ŒäºNæ¬¡ï¼Œè®¡ç®—æˆé•¿åçš„ç•ªæ•°<br/>
                            2.æ€»åˆ†æ•°å’Œæ¸¸æˆå†…æœ‰å¾®å°è¯¯å·®ï¼Œä½†æ˜¯å‡ ä¹ä¸ä¼šå·®ä¸€ä¸ªæ•°é‡çº§ï¼ŒåŸå› å¦‚ä¸‹ï¼šç”±äºæ­¤è®¡ç®—å™¨æœ€æ—©çš„å…³å¡åªæ”¯æŒåˆ°EX1ï¼Œè¾“å…¥æ¸¸æˆå†…å‚æ•°å¼€å§‹è®¡ç®—ï¼Œè€Œæ¸¸æˆå†…åªæ˜¾ç¤ºå°æ•°ç‚¹å2ä½ï¼Œ
                                è€Œå®ƒå®é™…è®¡ç®—æ—¶ä¸æ­¢å°æ•°ç‚¹åä¸¤ä½ï¼Œå­˜åœ¨ç²¾åº¦æŸå¤±é—®é¢˜ï¼Œä¸ç®¡æ˜¯ç†è®ºè¿˜æ˜¯å®æµ‹ï¼Œç²¾åº¦æŸå¤±å¸¦æ¥çš„å½±å“éå¸¸å°ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡<br/>
                            3.è®¾è®¡æˆä»EX1å¼€å§‹çš„åŸå› ï¼šæˆ‘åœ¨è®¾è®¡æ­¤è®¡ç®—å™¨çš„æ—¶å€™è€ƒè™‘è¿‡ç²¾åº¦é—®é¢˜ï¼Œå¦‚æœä»è·å–æŠ¤èº«ç¬¦çš„å…³å¡å°±å¼€å§‹è®°å½•æˆé•¿ï¼Œå°±å¯ä»¥æ•°æ®å®Œå…¨ä¸€è‡´ï¼Œä½†æ˜¯åœ¨é˜µå®¹æˆå‹å‰å˜æ•°å¤ªå¤šï¼ŒæŠ¤èº«ç¬¦ç±»å‹ã€
                                æ˜¯å¦Plusã€æŸä¸ªå…³å¡å¯èƒ½äºæ‰æŸä¸ªæŠ¤èº«ç¬¦çš„æˆé•¿ç­‰ç­‰ï¼Œä¼šå¤§é‡å¢åŠ ä½¿ç”¨æˆæœ¬ï¼Œæ²¡æœ‰å¿…è¦ï¼Œè€Œå¤§éƒ¨åˆ†ä¸»æµç©æ³•åœ¨EX1å·¦å³æˆå‹
                        </span>
                    </span>
                    å½“å‰é…ç½®çš„æé™æ˜¯ï¼š<span id="resultText">ç­‰å¾…è®¡ç®—...</span>
                </h3>
            </div>

            <div class="output-log" id="outputLog">
                <div class="output-line">ç­‰å¾…è®¡ç®—...</div>
            </div>
        </div>
    </div>
</div>

<script>
    // å®šä¹‰å¸¸é‡
    const FZ_TYPE_PZ = "è†¨èƒ€è´Ÿé‡";
    const FZ_TYPE_TS = "å¤©ä½¿è´Ÿé‡";
    const FZ_TYPE_NORMAL = "æ™®é€šè´Ÿé‡";
    const YG_TYPE_PZ = "è†¨èƒ€æœˆå…‰";
    const YG_TYPE_TS = "å¤©ä½¿æœˆå…‰";
    const YG_TYPE_NORMAL = "æ™®é€šæœˆå…‰";
    const DY_TYPE_KW_PZ = "å¡ç»´è†¨èƒ€ç›—å°";
    const DY_TYPE_OTHER_PZ = "å…¶ä»–å¡è†¨èƒ€ç›—å°";
    const DY_TYPE_NORMAL = "æ™®é€šç›—å°";
    const DY_TYPE_HACKER_ONLY = "é»‘å®¢åªå˜ç›—å°";

    // æ•°é‡çº§å¯¹ç…§è¡¨
    const MAGNITUDE_MAP = {
        "ä¸‡": 4,
        "äº¿": 8,
        "å…†": 12,
        "äº¬": 16,
        "å“": 20,
        "ç§­": 24,
        "ç©°": 28,
        "æ²Ÿ": 32,
        "æ¶§": 36,
        "æ­£": 40,
        "è½½": 44,
        "æ": 48
    };

    // åˆå§‹åŒ–å…³å¡è¦æ±‚åˆ†æ•°
    const REQUIRED_SCORE = initRequiredScore();

    // è‡ªå®šä¹‰æŠ¤èº«ç¬¦è®¡æ•°å™¨
    let customParamCounter = 1;
    // é˜¶æ®µè®¡æ•°å™¨
    let stageCounter = 1;
    // æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªé˜¶æ®µ
    let hasNextStage = true;

    // åˆå§‹åŒ–å…³å¡è¦æ±‚åˆ†æ•°
    function initRequiredScore() {
        const ORIGINAL_REQUIRED_SCORE =
            "1.00E+06,1.20E+07,9.08E+07,8.11E+08,8.43E+09,1.00E+11,1.35E+12,2.06E+13,3.48E+14,6.54E+15,1.36E+17,3.09E+18,7.68E+19,2.08E+21,6.64E+22,2.46E+24,1.05E+26,5.15E+27,2.82E+29,1.83E+31,1.31E+33,1.07E+35,9.72E+36,9.94E+38,1.14E+41,1.46E+43,2.08E+45,3.31E+47,5.85E+49,1.26E+52,3.00E+54,8.71E+56,2.79E+59,1.08E+62,4.63E+64,2.40E+67,1.37E+70,9.41E+72,7.15E+75,7.09E+78,9.17E+81,1.55E+85,3.40E+88,9.73E+91,3.63E+95,1.11E+99,1.11E+103,9.11E+106,9.72E+110,1.35E+115,2.81E+119,8.79E+123,4.12E+128,2.90E+134,3.06E+138,4.84E+143,1.15E+149,4.10E+154,2.19E+160,1.76E+166,2.11E+172,3.80E+178,1.03E+185,4.17E+191,2.54E+198,2.32E+205,3.18E+212,6.54E+219,2.02E+227,9.31E+234,6.46E+242,6.72E+250,1.05E+259,2.45E+267,8.60E+275,4.53E+284,3.58E+293,4.24E+302,5.7E310,5.7E318,5.7E326,5.7E334,5.7E342,5.7E350,5.7E359,5.7E368,5.7E377,5.7E386,5.7E395,5.7E405,5.7E415,5.7E425,5.7E435,5.7E445,5.7E455,5.7E466,5.7E477,5.7E488,5.7E499,9.999E510,9.999E522,9.999E534,9.999E546,9.999E558,9.999E571,9.999E584,9.999E597,9.999E611,9.999E625,9.999E639,9.999E654,9.999E669,9.999E684,9.999E699,9.999E715,9.999E731,9.999E748,9.999E765,9.999E783,9.999E801,9.999E820,9.999E839,9.999E859,9.999E879,9.999E900,9.999E921,9.999E943,9.999E966,9.999E990,9.999E1015,9.999E1041,9.999E1068,9.999E1096,2.9997E1126,9.999E1155,9.999E1186,9.999E1218,9.999E1251,9.999E1285,9.999E1320,9.999E1356,9.999E1393,9.999E1431,9.999E1470,9.999E1510,9.999E1551,9.999E1593,9.999E1636,9.999E1680,2.9997E1726,9.999E1771,9.999E1818,2.9997E1867,9.999E1915,9.999E1965,9.999E2016,9.999E2068,2.9997E2122,9.999E2175,9.999E2230,9.999E2286,9.999E2343,9.999E2401,9.999E2460";
        const REQUIRED_SCORE = new Array(164);
        const split = ORIGINAL_REQUIRED_SCORE.split(",");
        for (let i = 0; i < split.length; i++) {
            REQUIRED_SCORE[i] = new Decimal(split[i]);
        }
        return REQUIRED_SCORE;
    }


    // ç§‘å­¦è®¡æ•°æ³•æ ¼å¼åŒ–
    function formatScientific(number) {
        if (number.isZero()) return "0.00";
        return number.toExponential(2);
    }

    // è§£ææ•°å€¼è¾“å…¥ï¼Œæ”¯æŒæ•°å­—ã€ç§‘å­¦è®¡æ•°æ³•å’Œå•ä½
    function parseValue(input) {
        if (input.includes('e') || input.includes('E')) {
            return new Decimal(input);
        }

        let unit = null;
        let numericPart = input;

        for (const unitChar in MAGNITUDE_MAP) {
            if (input.includes(unitChar)) {
                unit = unitChar;
                numericPart = input.replace(unitChar, '');
                break;
            }
        }

        const value = new Decimal(numericPart);

        if (unit) {
            const magnitude = MAGNITUDE_MAP[unit];
            return value.times(Decimal.pow(10, magnitude));
        }

        return value;
    }

    // è·å–æ•°å€¼ï¼Œå¦‚æœä¸ºç©ºåˆ™è¿”å›0
    function getValueOrDefault(value, defaultValue = 0) {
        return value === '' ? defaultValue : value;
    }

    // è·å–æŠ¤èº«ç¬¦å¯ç”¨çŠ¶æ€
    function getTalismanEnabledStates() {
        return {
            dy: document.getElementById('dyTalismanEnabled').checked,
            fz: document.getElementById('fzTalismanEnabled').checked,
            yg: document.getElementById('ygTalismanEnabled').checked
        };
    }

    // æ‰§è¡Œå½“å‰å…³å¡è®¡ç®—
    function executeCurrentStage(curLevel, actualLevel, nextStageActualLevel, dy, fz, yg, lose_fz, lose_yg, eat_fog,
                                 dy_type, fz_type, yg_type, basicFan, basicScore, dy_times, fz_times, yg_times, customizedParams, stageName = "",
                                 talismanEnabled = {
                                     dy: true,
                                     fz: true,
                                     yg: true
                                 }
    ) {
        let toNextStage = false;
        let outputLines = [];
        let isFirstLoop = true;
        let startLevel = curLevel;

        // å¦‚æœä¸Šä¸€ä¸ªé˜¶æ®µç»“æŸäº†ï¼Œæ²¡æœ‰ä¸‹ä¸€ä¸ªé˜¶æ®µï¼Œç›´æ¥è¿”å›
        if (!hasNextStage) {
            return {
                nextLevel: curLevel,
                dy: dy,
                fz: fz,
                yg: yg,
                outputLines: outputLines
            };
        }

        // å¦‚æœæœ‰å®é™…å¼€å§‹å…³å¡ï¼Œç›´æ¥ä½¿ç”¨å¡«å†™çš„å€¼
        if (actualLevel !== 0) {
            curLevel = actualLevel;
            startLevel = actualLevel;
            outputLines.push(`<span class="highlight">ä½¿ç”¨å®é™…å¼€å§‹å…³å¡: EX${actualLevel}</span>`);
        }

        if (stageName) {
            outputLines.push(`<span class="highlight">=== é˜¶æ®µ: ${stageName} ===</span>`);
        }

        // è¾“å‡ºæŠ¤èº«ç¬¦å¯ç”¨çŠ¶æ€
        if (talismanEnabled.dy) {
            outputLines.push(`<span class="highlight">ç›—å°æŠ¤èº«ç¬¦å·²å¯ç”¨</span>`);
        }
        if (talismanEnabled.fz) {
            outputLines.push(`<span class="highlight">è´Ÿé‡æŠ¤èº«ç¬¦å·²å¯ç”¨</span>`);
        }
        if (talismanEnabled.yg) {
            outputLines.push(`<span class="highlight">æœˆå…‰æŠ¤èº«ç¬¦å·²å¯ç”¨</span>`);
        }

        while (!toNextStage) {
            if (talismanEnabled.dy) {
                outputLines.push(`EX${curLevel}ç›—å°ï¼š${formatValueDisplay(dy)}`);
            }

            // è€ƒè™‘äºè´Ÿé‡ - åªåœ¨è´Ÿé‡æŠ¤èº«ç¬¦å¯ç”¨æ—¶å¤„ç†
            if (talismanEnabled.fz) {
                if (lose_fz <= 0) {
                    // è´Ÿé‡ç±»å‹
                    switch (fz_type) {
                        case FZ_TYPE_NORMAL:
                            fz = fz.times(1.5);
                            break;
                        case FZ_TYPE_TS:
                            fz = fz.times(2);
                            break;
                        case FZ_TYPE_PZ:
                            fz = fz.times(1.5 * 1.5);
                            break;
                    }
                } else {
                    lose_fz--;
                }
                outputLines.push(`EX${curLevel}è´Ÿé‡ï¼š${formatValueDisplay(fz)}`);
            }

            // è€ƒè™‘äºæœˆå…‰ - åªåœ¨æœˆå…‰æŠ¤èº«ç¬¦å¯ç”¨æ—¶å¤„ç†
            if (talismanEnabled.yg) {
                if (lose_yg <= 0) {
                    // æœˆå…‰ç±»å‹
                    switch (yg_type) {
                        case YG_TYPE_NORMAL:
                            yg = yg.times(1.5);
                            break;
                        case YG_TYPE_TS:
                            yg = yg.times(2);
                            break;
                        case YG_TYPE_PZ:
                            yg = yg.times(1.5 * 1.5);
                            break;
                    }
                } else {
                    lose_yg--;
                }
                outputLines.push(`EX${curLevel}æœˆå…‰ï¼š${formatValueDisplay(yg)}`);
            }

            // è®¡ç®—æ€»ç•ªæ•°å’Œåˆ†æ•°
            let zhiShuFan = new Decimal(1);

            // åªåœ¨æŠ¤èº«ç¬¦å¯ç”¨æ—¶è®¡ç®—å¯¹åº”éƒ¨åˆ†
            if (talismanEnabled.dy) {
                zhiShuFan = zhiShuFan.times(dy.pow(dy_times));
            }
            if (talismanEnabled.fz) {
                zhiShuFan = zhiShuFan.times(fz.pow(fz_times));
            }
            if (talismanEnabled.yg) {
                zhiShuFan = zhiShuFan.times(yg.pow(yg_times));
            }

            // æ·»åŠ è‡ªå®šä¹‰æŠ¤èº«ç¬¦å‚æ•°çš„è®¡ç®—
            if (customizedParams && customizedParams.length > 0) {
                customizedParams.forEach((param, index) => {
                    if (param.value && param.times) {
                        zhiShuFan = zhiShuFan.times(param.value.pow(param.times));
                    }
                });
            }

            const totalFan = zhiShuFan.times(basicFan);
            const totalScore = totalFan.times(basicScore);

            outputLines.push(`----EX${curLevel}åˆ†æ•°ï¼š${formatValueDisplay(totalScore)}`);

            // æ£€æŸ¥å½“å‰å…³å¡æ˜¯å¦èƒ½é€šè¿‡,å¦‚æœä¸èƒ½é€šè¿‡ï¼Œå°±æ²¡æœ‰ä¸‹ä¸€é˜¶æ®µäº†
            if (totalScore.lt(REQUIRED_SCORE[curLevel - 1])) {
                outputLines.push(
                    `<span class="highlight">æ— æ³•è¾¾åˆ°EX${curLevel}çš„è¦æ±‚åˆ†æ•° ${REQUIRED_SCORE[curLevel - 1]}</span>`
                );
                if (stageName) {
                    // ä¿®æ­£æ¨è¿›å…³å¡æ•°è®¡ç®—é€»è¾‘
                    const stagesAdvanced = curLevel - startLevel;
                    outputLines.push(`<span class="highlight">æœ¬é˜¶æ®µæ¨è¿›: ${stagesAdvanced} å…³</span>`);
                }
                console.log("Setting hasNextStage to false at level EX" + curLevel);
                hasNextStage = false;
                return {
                    nextLevel: curLevel,
                    dy: dy,
                    fz: fz,
                    yg: yg,
                    outputLines: outputLines
                };
            }

            // æ£€æŸ¥æ˜¯å¦èƒ½è¿›å…¥ä¸‹ä¸€å…³ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæˆé•¿åçš„åˆ†æ•°ä¸ä¸‹ä¸€å…³è¦æ±‚åˆ†æ•°æ¯”è¾ƒï¼‰
            // æ¨¡æ‹Ÿä¸€æ¬¡æˆé•¿åçš„åˆ†æ•°ï¼Œä½†ä¸å®é™…åº”ç”¨æˆé•¿
            let simulatedDy = dy;
            let simulatedFz = fz;
            let simulatedYg = yg;

            // æ¨¡æ‹Ÿç›—å°æˆé•¿ - åªåœ¨ç›—å°æŠ¤èº«ç¬¦å¯ç”¨æ—¶å¤„ç†
            if (talismanEnabled.dy) {
                switch (dy_type) {
                    case DY_TYPE_KW_PZ:
                        simulatedDy = simulatedDy.times(Math.pow(1.3, 4));
                        break;
                    case DY_TYPE_OTHER_PZ:
                        simulatedDy = simulatedDy.times(Math.pow(1.3, 2));
                        break;
                    case DY_TYPE_NORMAL:
                        simulatedDy = simulatedDy.times(1.3);
                        break;
                    case DY_TYPE_HACKER_ONLY:
                        simulatedDy = simulatedDy.times(Math.pow(1.3, 6));
                        break;
                }
            }

            // æ¨¡æ‹Ÿè´Ÿé‡æˆé•¿ï¼ˆä¸è€ƒè™‘äºè´Ÿé‡ï¼‰- åªåœ¨è´Ÿé‡æŠ¤èº«ç¬¦å¯ç”¨æ—¶å¤„ç†
            if (talismanEnabled.fz) {
                switch (fz_type) {
                    case FZ_TYPE_NORMAL:
                        simulatedFz = simulatedFz.times(1.5);
                        break;
                    case FZ_TYPE_TS:
                        simulatedFz = simulatedFz.times(2);
                        break;
                    case FZ_TYPE_PZ:
                        simulatedFz = simulatedFz.times(1.5 * 1.5);
                        break;
                }
            }

            // æ¨¡æ‹Ÿæœˆå…‰æˆé•¿ï¼ˆä¸è€ƒè™‘äºæœˆå…‰ï¼‰- åªåœ¨æœˆå…‰æŠ¤èº«ç¬¦å¯ç”¨æ—¶å¤„ç†
            if (talismanEnabled.yg) {
                switch (yg_type) {
                    case YG_TYPE_NORMAL:
                        simulatedYg = simulatedYg.times(1.5);
                        break;
                    case YG_TYPE_TS:
                        simulatedYg = simulatedYg.times(2);
                        break;
                    case YG_TYPE_PZ:
                        simulatedYg = simulatedYg.times(1.5 * 1.5);
                        break;
                }
            }

            // è®¡ç®—æ¨¡æ‹Ÿæˆé•¿åçš„æ€»ç•ªæ•°å’Œåˆ†æ•°
            let simulatedZhiShuFan = new Decimal(1);

            // åªåœ¨æŠ¤èº«ç¬¦å¯ç”¨æ—¶è®¡ç®—å¯¹åº”éƒ¨åˆ†
            if (talismanEnabled.dy) {
                simulatedZhiShuFan = simulatedZhiShuFan.times(simulatedDy.pow(dy_times));
            }
            if (talismanEnabled.fz) {
                simulatedZhiShuFan = simulatedZhiShuFan.times(simulatedFz.pow(fz_times));
            }
            if (talismanEnabled.yg) {
                simulatedZhiShuFan = simulatedZhiShuFan.times(simulatedYg.pow(yg_times));
            }

            // æ·»åŠ è‡ªå®šä¹‰æŠ¤èº«ç¬¦å‚æ•°çš„è®¡ç®—
            if (customizedParams && customizedParams.length > 0) {
                customizedParams.forEach((param, index) => {
                    if (param.value && param.times) {
                        simulatedZhiShuFan = simulatedZhiShuFan.times(param.value.pow(param.times));
                    }
                });
            }

            const simulatedTotalFan = simulatedZhiShuFan.times(basicFan);
            const simulatedTotalScore = simulatedTotalFan.times(basicScore);

            // æ£€æŸ¥æ˜¯å¦èƒ½è¿›å…¥ä¸‹ä¸€å…³ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæˆé•¿åçš„åˆ†æ•°ä¸ä¸‹ä¸€å…³è¦æ±‚åˆ†æ•°æ¯”è¾ƒï¼‰
            if (simulatedTotalScore.lt(REQUIRED_SCORE[curLevel])) {
                toNextStage = true;
                outputLines.push(
                    `<span class="highlight">æ— æ³•è¾¾åˆ°EX${curLevel + 1}çš„è¦æ±‚åˆ†æ•° ${REQUIRED_SCORE[curLevel]}</span>`
                );
                if (stageName) {
                    // ä¿®æ­£æ¨è¿›å…³å¡æ•°è®¡ç®—é€»è¾‘ï¼ŒåŠ 1
                    const stagesAdvanced = curLevel - startLevel + 1;
                    outputLines.push(`<span class="highlight">æœ¬é˜¶æ®µæ¨è¿›: ${stagesAdvanced} å…³</span>`);
                }
            }

            // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ä¸‹ä¸€é˜¶æ®µçš„å®é™…å¼€å§‹å…³å¡-1ï¼ˆå¦‚æœæŒ‡å®šäº†ä¸‹ä¸€é˜¶æ®µçš„å®é™…å¼€å§‹å…³å¡ï¼‰
            if (nextStageActualLevel !== 0 && curLevel >= nextStageActualLevel - 1) {
                toNextStage = true;
                outputLines.push(
                    `<span class="highlight">å·²è¾¾åˆ°ä¸‹ä¸€é˜¶æ®µå®é™…å¼€å§‹å…³å¡-1 (EX${nextStageActualLevel - 1})ï¼Œç»“æŸå½“å‰é˜¶æ®µ</span>`);
                if (stageName) {
                    const stagesAdvanced = curLevel - startLevel + 1;
                    outputLines.push(`<span class="highlight">æœ¬é˜¶æ®µæ¨è¿›: ${stagesAdvanced} å…³</span>`);
                }
            }

            curLevel = curLevel + 1;

            // æ­£å¸¸ç›—å°æˆé•¿ - åªåœ¨ç›—å°æŠ¤èº«ç¬¦å¯ç”¨æ—¶å¤„ç†
            if (talismanEnabled.dy) {
                switch (dy_type) {
                    case DY_TYPE_KW_PZ:
                        dy = dy.times(Math.pow(1.3, 4));
                        break;
                    case DY_TYPE_OTHER_PZ:
                        dy = dy.times(Math.pow(1.3, 2));
                        break;
                    case DY_TYPE_NORMAL:
                        dy = dy.times(1.3);
                        break;
                    case DY_TYPE_HACKER_ONLY:
                        dy = dy.times(Math.pow(1.3, 6));
                        break;
                }

                // å¤„ç†åƒè¿·é›¾æ¬¡æ•° - åªåœ¨ç¬¬ä¸€æ¬¡å¾ªç¯ä¸­å¤„ç†
                if (talismanEnabled.dy && isFirstLoop && eat_fog > 0) {
                    for (let i = 0; i < eat_fog; i++) {
                        //è¿˜æ˜¯éœ€è¦æ ¹æ®ç›—å°çš„å°ç« ç±»å‹è®¡ç®—åƒè¿·é›¾çš„æˆé•¿ï¼Œè†¨èƒ€ç›—å°æ˜¯1.3^2ï¼Œæ™®é€šç›—å°æ˜¯1.3
                        switch (dy_type) {
                            case DY_TYPE_KW_PZ:
                                dy = dy.times(Math.pow(1.3, 2));
                                break;
                            case DY_TYPE_OTHER_PZ:
                                dy = dy.times(Math.pow(1.3, 2));
                                break;
                            case DY_TYPE_NORMAL:
                                dy = dy.times(1.3);
                                break;
                            case DY_TYPE_HACKER_ONLY:
                                dy = dy.times(Math.pow(1.3, 2));
                                break;
                        }
                    }
                    eat_fog = 0; // åƒè¿·é›¾æ¬¡æ•°è®¾ä¸º0
                }
            }

            isFirstLoop = false; // ç¬¬ä¸€æ¬¡å¾ªç¯ç»“æŸ

            // é˜²æ­¢æ— é™å¾ªç¯
            if (curLevel >= REQUIRED_SCORE.length) {
                toNextStage = true;
                outputLines.push(`<span class="highlight">å·²è¾¾åˆ°æœ€é«˜å…³å¡EX${curLevel}</span>`);
            }
        }

        return {
            nextLevel: curLevel,
            dy: dy,
            fz: fz,
            yg: yg,
            outputLines: outputLines
        };
    }

    // æ·»åŠ è‡ªå®šä¹‰æŠ¤èº«ç¬¦
    function addCustomParam() {
        const paramId = `customParam${customParamCounter}`;

        const customParamHTML = `
    <div class="custom-param-group" id="${paramId}">
        <div class="custom-param-header">
            <input type="text" class="custom-param-name" value="è‡ªå®šä¹‰æŠ¤èº«ç¬¦${customParamCounter}">
            <button type="button" class="remove-custom-param" onclick="removeCustomParam('${paramId}')">Ã—</button>
        </div>
        <div class="custom-param-inputs">
            <label>ä¹˜</label>
            <input type="text" class="custom-param-value" value="1">
            <label>ç•ª</label>
            <label>æ¬¡æ•°</label>
            <input type="number" class="custom-param-times" value="1" min="0" required>
        </div>
    </div>
`;

        document.getElementById('customParamsContainer').insertAdjacentHTML('beforeend', customParamHTML);

        // ç»‘å®šè¾“å…¥äº‹ä»¶ï¼Œå®ç°åŒå‘åŒæ­¥
        const paramElement = document.getElementById(paramId);
        const nameInput = paramElement.querySelector('.custom-param-name');
        const valueInput = paramElement.querySelector('.custom-param-value');
        const timesInput = paramElement.querySelector('.custom-param-times');

        // ç›‘å¬è¾“å…¥å˜åŒ–ï¼ŒåŒæ­¥åˆ°é˜¶æ®µ1
        [nameInput, valueInput, timesInput].forEach(input => {
            input.addEventListener('input', function () {
                syncTopCustomParamsToStage1();
            });
        });

        customParamCounter++;

        // åŒæ­¥åˆ°é˜¶æ®µ1
        syncTopCustomParamsToStage1();
    }

    // åŒæ­¥é¡¶éƒ¨è‡ªå®šä¹‰æŠ¤èº«ç¬¦åˆ°é˜¶æ®µ1
    function syncTopCustomParamsToStage1() {
        const stage1 = document.querySelector('.strategy-stage');
        if (!stage1) return;

        const stageCustomParamsContainer = stage1.querySelector('.stage-custom-params-container');
        if (!stageCustomParamsContainer) return;

        // æ¸…ç©ºé˜¶æ®µ1çš„è‡ªå®šä¹‰æŠ¤èº«ç¬¦
        stageCustomParamsContainer.innerHTML = '';

        // è·å–é¡¶éƒ¨çš„è‡ªå®šä¹‰æŠ¤èº«ç¬¦
        const topCustomParams = document.querySelectorAll('.custom-param-group');

        // é‡æ–°æ·»åŠ æ‰€æœ‰è‡ªå®šä¹‰æŠ¤èº«ç¬¦åˆ°é˜¶æ®µ1
        topCustomParams.forEach((param, index) => {
            const nameInput = param.querySelector('.custom-param-name');
            const valueInput = param.querySelector('.custom-param-inputs input[type="text"]');
            const timesInput = param.querySelector('.custom-param-inputs input[type="number"]');

            if (nameInput && valueInput && timesInput) {
                addStageCustomParamToContainer(
                    stageCustomParamsContainer,
                    nameInput.value,
                    valueInput.value,
                    timesInput.value
                );
            }
        });
    }

    // æ·»åŠ é˜¶æ®µè‡ªå®šä¹‰æŠ¤èº«ç¬¦åˆ°æŒ‡å®šå®¹å™¨ - ä¿®å¤ç‰ˆï¼ˆè§¦å‘è‡ªå®šä¹‰æŠ¤èº«ç¬¦åŒæ­¥ï¼‰
    function addStageCustomParamToContainer(container, name = "", value = "1", times = "1", triggerSync = true) {
        const paramId = `stageCustomParam${Date.now()}`;

        const customParamHTML = `
    <div class="stage-custom-param-group" id="${paramId}">
        <div class="stage-custom-param-inputs">
            <input type="text" class="stage-custom-param-name" value="${name}" placeholder="æŠ¤èº«ç¬¦åç§°">
            <label>ä¹˜</label>
            <input type="text" class="stage-custom-param-value" value="${value}">
            <label>ç•ª</label>
            <label>æ¬¡æ•°</label>
            <input type="number" class="stage-custom-param-times" value="${times}" min="0" required>
        </div>
        <button type="button" class="stage-remove-custom-param" onclick="removeStageCustomParam('${paramId}')">Ã—</button>
    </div>
`;

        container.insertAdjacentHTML('beforeend', customParamHTML);

        // ç»‘å®šè¾“å…¥äº‹ä»¶ï¼Œå®ç°åŒå‘åŒæ­¥
        const paramElement = document.getElementById(paramId);
        const nameInput = paramElement.querySelector('.stage-custom-param-name');
        const valueInput = paramElement.querySelector('.stage-custom-param-value');

        // åªç›‘å¬åç§°å’Œæ•°å€¼çš„å˜åŒ–
        [nameInput, valueInput].forEach(input => {
            input.addEventListener('input', function () {
                // åŒæ­¥åˆ°é¡¶éƒ¨ï¼ˆå¦‚æœæ˜¯é˜¶æ®µ1ï¼‰
                const stageElement = container.closest('.strategy-stage');
                if (stageElement && stageElement.id === 'stage1') {
                    syncStage1CustomParamsToTop();
                }

                // åŒæ­¥è‡ªå®šä¹‰æŠ¤èº«ç¬¦åˆ°åç»­é˜¶æ®µ
                const allStages = Array.from(document.querySelectorAll('.strategy-stage'));
                const currentStageIndex = allStages.indexOf(stageElement);
                syncCustomParams(currentStageIndex);
            });
        });

        // è§¦å‘åŒæ­¥ï¼ˆé™¤éæ˜ç¡®è®¾ç½®ä¸ºä¸è§¦å‘ï¼‰
        if (triggerSync) {
            const stageElement = container.closest('.strategy-stage');
            const allStages = Array.from(document.querySelectorAll('.strategy-stage'));
            const currentStageIndex = allStages.indexOf(stageElement);
            syncCustomParams(currentStageIndex);
        }

        return paramId;
    }

    // æ·»åŠ é˜¶æ®µè‡ªå®šä¹‰æŠ¤èº«ç¬¦ - ä¿®å¤ç‰ˆ
    function addStageCustomParam(stageId) {
        const container = document.getElementById(`stageCustomParams-${stageId}`);
        if (!container) return;

        // è·å–å½“å‰é˜¶æ®µçš„è‡ªå®šä¹‰æŠ¤èº«ç¬¦æ•°é‡ï¼Œç”¨äºå‘½å
        const currentCount = container.querySelectorAll('.stage-custom-param-group').length + 1;
        const paramId = addStageCustomParamToContainer(
            container,
            `è‡ªå®šä¹‰æŠ¤èº«ç¬¦${currentCount}`,
            "1",
            "1",
            true // è§¦å‘åŒæ­¥
        );

        // å¦‚æœæ˜¯é˜¶æ®µ1ï¼ŒåŒæ­¥åˆ°é¡¶éƒ¨
        if (stageId === 'stage1') {
            syncStage1CustomParamsToTop();
        }
    }

    // åŒæ­¥é˜¶æ®µ1è‡ªå®šä¹‰æŠ¤èº«ç¬¦åˆ°é¡¶éƒ¨
    function syncStage1CustomParamsToTop() {
        const stage1 = document.querySelector('.strategy-stage');
        if (!stage1) return;

        const stageCustomParamsContainer = stage1.querySelector('.stage-custom-params-container');
        if (!stageCustomParamsContainer) return;

        // æ¸…ç©ºé¡¶éƒ¨çš„è‡ªå®šä¹‰æŠ¤èº«ç¬¦
        document.getElementById('customParamsContainer').innerHTML = '';

        // è·å–é˜¶æ®µ1çš„è‡ªå®šä¹‰æŠ¤èº«ç¬¦
        const stageCustomParams = stageCustomParamsContainer.querySelectorAll('.stage-custom-param-group');

        // é‡æ–°æ·»åŠ æ‰€æœ‰è‡ªå®šä¹‰æŠ¤èº«ç¬¦åˆ°é¡¶éƒ¨
        stageCustomParams.forEach((param, index) => {
            const nameInput = param.querySelector('.stage-custom-param-name');
            const valueInput = param.querySelector('.stage-custom-param-value');
            const timesInput = param.querySelector('.stage-custom-param-times');

            if (nameInput && valueInput && timesInput) {
                addCustomParamToTop(
                    nameInput.value,
                    valueInput.value,
                    timesInput.value
                );
            }
        });
    }

    // æ·»åŠ è‡ªå®šä¹‰æŠ¤èº«ç¬¦åˆ°é¡¶éƒ¨
    function addCustomParamToTop(name = "", value = "1", times = "1") {
        const paramId = `customParam${customParamCounter}`;

        const customParamHTML = `
    <div class="custom-param-group" id="${paramId}">
        <div class="custom-param-header">
            <input type="text" class="custom-param-name" value="${name}">
            <button type="button" class="remove-custom-param" onclick="removeCustomParam('${paramId}')">Ã—</button>
        </div>
        <div class="custom-param-inputs">
            <label>ä¹˜</label>
            <input type="text" class="custom-param-value" value="${value}">
            <label>ç•ª</label>
            <label>æ¬¡æ•°</label>
            <input type="number" class="custom-param-times" value="${times}" min="0" required>
        </div>
    </div>
`;

        document.getElementById('customParamsContainer').insertAdjacentHTML('beforeend', customParamHTML);

        // ç»‘å®šè¾“å…¥äº‹ä»¶ï¼Œå®ç°åŒå‘åŒæ­¥
        const paramElement = document.getElementById(paramId);
        const nameInput = paramElement.querySelector('.custom-param-name');
        const valueInput = paramElement.querySelector('.custom-param-value');
        const timesInput = paramElement.querySelector('.custom-param-times');

        // ç›‘å¬è¾“å…¥å˜åŒ–ï¼ŒåŒæ­¥åˆ°é˜¶æ®µ1
        [nameInput, valueInput, timesInput].forEach(input => {
            input.addEventListener('input', function () {
                syncTopCustomParamsToStage1();
            });
        });

        customParamCounter++;
    }

    // åˆ é™¤è‡ªå®šä¹‰æŠ¤èº«ç¬¦
    function removeCustomParam(paramId) {
        const element = document.getElementById(paramId);
        if (element) {
            element.remove();
            // åŒæ­¥åˆ°é˜¶æ®µ1
            syncTopCustomParamsToStage1();
        }
    }

    // åˆ é™¤é˜¶æ®µè‡ªå®šä¹‰æŠ¤èº«ç¬¦ - ä¿®å¤ç‰ˆï¼ˆè§¦å‘è‡ªå®šä¹‰æŠ¤èº«ç¬¦åŒæ­¥ï¼‰
    function removeStageCustomParam(paramId) {
        const element = document.getElementById(paramId);
        if (element) {
            const container = element.closest('.stage-custom-params-container');
            element.remove();

            // å¦‚æœæ˜¯é˜¶æ®µ1ï¼ŒåŒæ­¥åˆ°é¡¶éƒ¨
            const stage1 = document.querySelector('.strategy-stage');
            if (stage1 && container.closest('.strategy-stage') === stage1) {
                syncStage1CustomParamsToTop();
            }

            // åŒæ­¥è‡ªå®šä¹‰æŠ¤èº«ç¬¦åˆ°åç»­é˜¶æ®µ
            const stageElement = container.closest('.strategy-stage');
            const allStages = Array.from(document.querySelectorAll('.strategy-stage'));
            const currentStageIndex = allStages.indexOf(stageElement);
            syncCustomParams(currentStageIndex);
        }
    }

    // æ›´æ–°é˜¶æ®µæŠ¤èº«ç¬¦å†…å®¹æ˜¾ç¤ºçŠ¶æ€
    function updateStageTalismanContent(stageElement, talismanType, isEnabled) {
        const content = stageElement.querySelector(`.talisman-card:nth-child(${getTalismanCardIndex(talismanType)}) .talisman-content`);
        if (content) {
            if (isEnabled) {
                content.classList.remove('hidden');
            } else {
                content.classList.add('hidden');
            }
        }
    }

    // è·å–æŠ¤èº«ç¬¦å¡ç‰‡åœ¨é˜¶æ®µä¸­çš„ç´¢å¼•
    function getTalismanCardIndex(talismanType) {
        const types = {dy: 3, fz: 4, yg: 5}; // é˜¶æ®µå†…å®¹ä¸­æŠ¤èº«ç¬¦å¡ç‰‡çš„é¡ºåº
        return types[talismanType] || 3;
    }

    // æ›´æ–°é¡¶éƒ¨æŠ¤èº«ç¬¦å†…å®¹æ˜¾ç¤ºçŠ¶æ€
    function updateTopTalismanContent(talismanType, isEnabled) {
        const content = document.querySelector(`#${talismanType}TalismanCard .talisman-content`);
        if (content) {
            if (isEnabled) {
                content.classList.remove('hidden');
            } else {
                content.classList.add('hidden');
            }
        }
    }

    // åŒæ­¥é¡¶éƒ¨æŠ¤èº«ç¬¦çŠ¶æ€åˆ°é˜¶æ®µ1
    function syncTalismanStateToStage1() {
        const stage1 = document.querySelector('.strategy-stage');
        if (!stage1) return;

        const stageDyEnabled = stage1.querySelector('.stage-dy-enabled');
        const stageFzEnabled = stage1.querySelector('.stage-fz-enabled');
        const stageYgEnabled = stage1.querySelector('.stage-yg-enabled');

        if (stageDyEnabled) {
            stageDyEnabled.checked = document.getElementById('dyTalismanEnabled').checked;
            updateStageTalismanContent(stage1, 'dy', stageDyEnabled.checked);
        }

        if (stageFzEnabled) {
            stageFzEnabled.checked = document.getElementById('fzTalismanEnabled').checked;
            updateStageTalismanContent(stage1, 'fz', stageFzEnabled.checked);
        }

        if (stageYgEnabled) {
            stageYgEnabled.checked = document.getElementById('ygTalismanEnabled').checked;
            updateStageTalismanContent(stage1, 'yg', stageYgEnabled.checked);
        }
    }

    // åŒæ­¥é˜¶æ®µ1æŠ¤èº«ç¬¦çŠ¶æ€åˆ°é¡¶éƒ¨
    function syncStage1TalismanStateToTop() {
        const stage1 = document.querySelector('.strategy-stage');
        if (!stage1) return;

        const stageDyEnabled = stage1.querySelector('.stage-dy-enabled');
        const stageFzEnabled = stage1.querySelector('.stage-fz-enabled');
        const stageYgEnabled = stage1.querySelector('.stage-yg-enabled');

        if (stageDyEnabled) {
            document.getElementById('dyTalismanEnabled').checked = stageDyEnabled.checked;
            updateTopTalismanContent('dy', stageDyEnabled.checked);
        }

        if (stageFzEnabled) {
            document.getElementById('fzTalismanEnabled').checked = stageFzEnabled.checked;
            updateTopTalismanContent('fz', stageFzEnabled.checked);
        }

        if (stageYgEnabled) {
            document.getElementById('ygTalismanEnabled').checked = stageYgEnabled.checked;
            updateTopTalismanContent('yg', stageYgEnabled.checked);
        }
    }

    // åœ¨initå‡½æ•°ä¸­æ·»åŠ æŠ¤èº«ç¬¦å¼€å…³çš„ç›‘å¬äº‹ä»¶
    function setupTalismanToggles() {
        // é¡¶éƒ¨æŠ¤èº«ç¬¦å¼€å…³
        document.getElementById('dyTalismanEnabled').addEventListener('change', function () {
            const content = document.querySelector('#dyTalismanCard .talisman-content');
            if (this.checked) {
                content.classList.remove('hidden');
            } else {
                content.classList.add('hidden');
            }

            // åŒæ­¥åˆ°é˜¶æ®µ1
            syncTalismanStateToStage1();
        });

        document.getElementById('fzTalismanEnabled').addEventListener('change', function () {
            const content = document.querySelector('#fzTalismanCard .talisman-content');
            if (this.checked) {
                content.classList.remove('hidden');
            } else {
                content.classList.add('hidden');
            }

            // åŒæ­¥åˆ°é˜¶æ®µ1
            syncTalismanStateToStage1();
        });

        document.getElementById('ygTalismanEnabled').addEventListener('change', function () {
            const content = document.querySelector('#ygTalismanCard .talisman-content');
            if (this.checked) {
                content.classList.remove('hidden');
            } else {
                content.classList.add('hidden');
            }

            // åŒæ­¥åˆ°é˜¶æ®µ1
            syncTalismanStateToStage1();
        });
    }

    // ä¸ºç­–ç•¥é˜¶æ®µå®¹å™¨æ·»åŠ äº‹ä»¶å§”æ‰˜ï¼Œå¤„ç†é˜¶æ®µå†…æŠ¤èº«ç¬¦å¼€å…³çš„å˜åŒ–
    function setupStageTalismanToggles() {
        document.getElementById('strategyStagesContainer').addEventListener('change', function (e) {
            if (e.target.classList.contains('stage-dy-enabled') ||
                e.target.classList.contains('stage-fz-enabled') ||
                e.target.classList.contains('stage-yg-enabled')) {

                const stageElement = e.target.closest('.strategy-stage');
                const talismanType = e.target.classList.contains('stage-dy-enabled') ? 'dy' :
                    e.target.classList.contains('stage-fz-enabled') ? 'fz' : 'yg';

                updateStageTalismanContent(stageElement, talismanType, e.target.checked);

                // å¦‚æœæ˜¯é˜¶æ®µ1ï¼ŒåŒæ­¥åˆ°é¡¶éƒ¨
                if (stageElement.id === 'stage1') {
                    syncStage1TalismanStateToTop();
                }
            }
        });
    }

    // æ·»åŠ ç­–ç•¥é˜¶æ®µ - ä¿®å¤ç‰ˆï¼ˆç¡®ä¿æŠ¤èº«ç¬¦ç±»å‹æ­£ç¡®ç»§æ‰¿ï¼‰
    function addStrategyStage(stageData = null) {
        const stageId = `stage${stageCounter}`;
        const stageNumber = stageCounter;

        // è·å–ä¸Šä¸€ä¸ªé˜¶æ®µçš„å‚æ•°ä½œä¸ºé»˜è®¤å€¼
        let defaultData = {};
        const allStages = document.querySelectorAll('.strategy-stage');

        if (allStages.length > 0) {
            // è·å–æœ€åä¸€ä¸ªé˜¶æ®µ
            const lastStage = allStages[allStages.length - 1];

            // è·å–æœ€åä¸€ä¸ªé˜¶æ®µçš„å‚æ•°
            defaultData = {
                name: `é˜¶æ®µ${stageNumber}`,
                actualLevel: 0,
                dy_type: lastStage.querySelector('.dy-type').value,
                fz_type: lastStage.querySelector('.fz-type').value,
                yg_type: lastStage.querySelector('.yg-type').value,
                basicFan: parseInt(lastStage.querySelector('.basic-fan').value),
                basicScore: parseInt(lastStage.querySelector('.basic-score').value),
                dy_times: parseInt(lastStage.querySelector('.dy-times').value),
                fz_times: parseInt(lastStage.querySelector('.fz-times').value),
                yg_times: parseInt(lastStage.querySelector('.yg-times').value),
                eat_fog: 0, // å›ºå®šä¸º0ï¼Œä¸ç»§æ‰¿
                lose_fz: 0, // å›ºå®šä¸º0ï¼Œä¸ç»§æ‰¿
                lose_yg: 0, // å›ºå®šä¸º0ï¼Œä¸ç»§æ‰¿
                dy_enabled: lastStage.querySelector('.stage-dy-enabled').checked,
                fz_enabled: lastStage.querySelector('.stage-fz-enabled').checked,
                yg_enabled: lastStage.querySelector('.stage-yg-enabled').checked,
                customizedParams: getStageCustomParamsData(lastStage)
            };
        } else {
            // å¦‚æœæ²¡æœ‰é˜¶æ®µï¼Œä½¿ç”¨é¡¶éƒ¨å‚æ•°çš„å½“å‰å€¼ä½œä¸ºé»˜è®¤å€¼
            defaultData = {
                name: `é˜¶æ®µ${stageNumber}`,
                actualLevel: 0,
                dy_type: document.getElementById('dy_type').value,
                fz_type: document.getElementById('fz_type').value,
                yg_type: document.getElementById('yg_type').value,
                basicFan: parseInt(document.getElementById('basicFan').value),
                basicScore: parseInt(document.getElementById('basicScore').value),
                dy_times: parseInt(document.getElementById('dy_times').value),
                fz_times: parseInt(document.getElementById('fz_times').value),
                yg_times: parseInt(document.getElementById('yg_times').value),
                eat_fog: parseInt(getValueOrDefault(document.getElementById('eat_fog').value, 0)),
                lose_fz: parseInt(getValueOrDefault(document.getElementById('lose_fz').value, 0)),
                lose_yg: parseInt(getValueOrDefault(document.getElementById('lose_yg').value, 0)),
                dy_enabled: document.getElementById('dyTalismanEnabled').checked,
                fz_enabled: document.getElementById('fzTalismanEnabled').checked,
                yg_enabled: document.getElementById('ygTalismanEnabled').checked,
                customizedParams: getCustomizedParams()
            };
        }

        // å¦‚æœæä¾›äº†é˜¶æ®µæ•°æ®ï¼Œåˆ™ä½¿ç”¨æä¾›çš„æ•°æ®è¦†ç›–é»˜è®¤å€¼
        if (stageData) {
            defaultData = {...defaultData, ...stageData};
        }

        const stageHTML = `
        <div class="strategy-stage" id="${stageId}">
            <div class="stage-header">
                <div class="stage-title">é˜¶æ®µ ${stageNumber}</div>
                <div class="stage-controls">
                    <span class="toggle-stage-icon open" title="æ”¶èµ·é˜¶æ®µå†…å®¹">âˆ’</span>
                    <button type="button" class="remove-stage" onclick="removeStage('${stageId}')">Ã—</button>
                </div>
            </div>
            <div class="stage-content">
                <div class="stage-form-group">
                    <label>é˜¶æ®µåç§°</label>
                    <input type="text" class="stage-name" value="${defaultData.name}" placeholder="é˜¶æ®µåç§°">
                </div>
                <div class="stage-form-group">
                    <label>å®é™…å¼€å§‹å…³å¡</label>
                    <input type="number" class="actual-level actual-level-input" value="${defaultData.actualLevel || ''}" placeholder="ä¸å¡«åˆ™ä½¿ç”¨å‰ä¸€é˜¶æ®µæé™" min="1" max="163">
                </div>

                <!-- ç›—å°æŠ¤èº«ç¬¦å¡ç‰‡ -->
                <div class="talisman-card">
                    <div class="talisman-header">
                        <div class="talisman-title">æŠ¤èº«ç¬¦ - ç›—å°</div>
                        <label class="toggle-switch">
                            <input type="checkbox" class="stage-dy-enabled" ${defaultData.dy_enabled ? 'checked' : ''}>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="talisman-content">
                        <div class="stage-form-group">
                            <label>ç›—å°ç±»å‹</label>
                            <select class="dy-type">
                                <option value="æ™®é€šç›—å°" ${defaultData.dy_type === 'æ™®é€šç›—å°' ? 'selected' : ''}>æ™®é€šç›—å°1.3</option>
                                <option value="å¡ç»´è†¨èƒ€ç›—å°" ${defaultData.dy_type === 'å¡ç»´è†¨èƒ€ç›—å°' ? 'selected' : ''}>å¡ç»´è†¨èƒ€ç›—å°1.3^4</option>
                                <option value="å…¶ä»–å¡è†¨èƒ€ç›—å°" ${defaultData.dy_type === 'å…¶ä»–å¡è†¨èƒ€ç›—å°' ? 'selected' : ''}>å…¶ä»–å¡è†¨èƒ€ç›—å°1.3^2</option>
                                <option value="é»‘å®¢åªå˜ç›—å°" ${defaultData.dy_type === 'é»‘å®¢åªå˜ç›—å°' ? 'selected' : ''}>é»‘å®¢åªå˜ç›—å°1.3^6</option>
                            </select>
                        </div>
                        <div class="stage-form-group">
                            <label>ç›—å°æ¬¡æ•°</label>
                            <input type="number" class="dy-times" value="${defaultData.dy_times}" min="0">
                        </div>
                        <div class="stage-form-group">
                            <label>åƒè¿·é›¾æ¬¡æ•°</label>
                            <input type="number" class="eat-fog" value="${defaultData.eat_fog}" min="0">
                        </div>
                    </div>
                </div>

                <!-- è´Ÿé‡æŠ¤èº«ç¬¦å¡ç‰‡ -->
                <div class="talisman-card">
                    <div class="talisman-header">
                        <div class="talisman-title">æŠ¤èº«ç¬¦ - è´Ÿé‡</div>
                        <label class="toggle-switch">
                            <input type="checkbox" class="stage-fz-enabled" ${defaultData.fz_enabled ? 'checked' : ''}>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="talisman-content">
                        <div class="stage-form-group">
                            <label>è´Ÿé‡ç±»å‹</label>
                            <select class="fz-type">
                                <option value="è†¨èƒ€è´Ÿé‡" ${defaultData.fz_type === 'è†¨èƒ€è´Ÿé‡' ? 'selected' : ''}>è†¨èƒ€è´Ÿé‡</option>
                                <option value="å¤©ä½¿è´Ÿé‡" ${defaultData.fz_type === 'å¤©ä½¿è´Ÿé‡' ? 'selected' : ''}>å¤©ä½¿è´Ÿé‡</option>
                                <option value="æ™®é€šè´Ÿé‡" ${defaultData.fz_type === 'æ™®é€šè´Ÿé‡' ? 'selected' : ''}>æ™®é€šè´Ÿé‡</option>
                            </select>
                        </div>
                        <div class="stage-form-group">
                            <label>è´Ÿé‡æ¬¡æ•°</label>
                            <input type="number" class="fz-times" value="${defaultData.fz_times}" min="0">
                        </div>
                        <div class="stage-form-group">
                            <label>äºè´Ÿé‡æ¬¡æ•°</label>
                            <input type="number" class="lose-fz" value="${defaultData.lose_fz}" min="0">
                        </div>
                    </div>
                </div>

                <!-- æœˆå…‰æŠ¤èº«ç¬¦å¡ç‰‡ -->
                <div class="talisman-card">
                    <div class="talisman-header">
                        <div class="talisman-title">æŠ¤èº«ç¬¦ - æœˆå…‰</div>
                        <label class="toggle-switch">
                            <input type="checkbox" class="stage-yg-enabled" ${defaultData.yg_enabled ? 'checked' : ''}>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="talisman-content">
                        <div class="stage-form-group">
                            <label>æœˆå…‰ç±»å‹</label>
                            <select class="yg-type">
                                <option value="æ™®é€šæœˆå…‰" ${defaultData.yg_type === 'æ™®é€šæœˆå…‰' ? 'selected' : ''}>æ™®é€šæœˆå…‰</option>
                                <option value="è†¨èƒ€æœˆå…‰" ${defaultData.yg_type === 'è†¨èƒ€æœˆå…‰' ? 'selected' : ''}>è†¨èƒ€æœˆå…‰</option>
                                <option value="å¤©ä½¿æœˆå…‰" ${defaultData.yg_type === 'å¤©ä½¿æœˆå…‰' ? 'selected' : ''}>å¤©ä½¿æœˆå…‰</option>
                            </select>
                        </div>
                        <div class="stage-form-group">
                            <label>æœˆå…‰æ¬¡æ•°</label>
                            <input type="number" class="yg-times" value="${defaultData.yg_times}" min="0">
                        </div>
                        <div class="stage-form-group">
                            <label>äºæœˆå…‰æ¬¡æ•°</label>
                            <input type="number" class="lose-yg" value="${defaultData.lose_yg}" min="0">
                        </div>
                    </div>
                </div>

                <div class="stage-form-group basic-fan-group">
                    <label>åŸºç¡€ç•ªæ•°</label>
                    <input type="number" class="basic-fan" value="${defaultData.basicFan}" min="1">
                </div>
                <div class="stage-form-group basic-score-group">
                    <label>åŸºç¡€åˆ†æ•°</label>
                    <input type="number" class="basic-score" value="${defaultData.basicScore}" min="1">
                </div>
                <div class="stage-form-group" style="grid-column: 1 / -1;">
                    <button type="button" class="add-stage-custom-param-btn strategy-btn" onclick="addStageCustomParam('${stageId}')">
                        <span class="add-icon">+</span> æ·»åŠ è‡ªå®šä¹‰æŠ¤èº«ç¬¦
                    </button>
                    <div class="stage-custom-params-container" id="stageCustomParams-${stageId}">
                        <!-- é˜¶æ®µè‡ªå®šä¹‰æŠ¤èº«ç¬¦å°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
            </div>
        </div>
    `;

        document.getElementById('strategyStagesContainer').insertAdjacentHTML('beforeend', stageHTML);

        // è®¾ç½®é˜¶æ®µæŠ¤èº«ç¬¦å†…å®¹çš„åˆå§‹æ˜¾ç¤ºçŠ¶æ€
        const stageElement = document.getElementById(stageId);
        if (stageElement) {
            const stageDyEnabled = stageElement.querySelector('.stage-dy-enabled');
            const stageFzEnabled = stageElement.querySelector('.stage-fz-enabled');
            const stageYgEnabled = stageElement.querySelector('.stage-yg-enabled');

            if (stageDyEnabled) {
                updateStageTalismanContent(stageElement, 'dy', stageDyEnabled.checked);
            }

            if (stageFzEnabled) {
                updateStageTalismanContent(stageElement, 'fz', stageFzEnabled.checked);
            }

            if (stageYgEnabled) {
                updateStageTalismanContent(stageElement, 'yg', stageYgEnabled.checked);
            }

            // ç»‘å®šè‡ªå®šä¹‰æŠ¤èº«ç¬¦äº‹ä»¶
            const customParamsContainer = stageElement.querySelector('.stage-custom-params-container');
            if (customParamsContainer) {
                bindCustomParamEvents(customParamsContainer);
            }
        }

        // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œè®¾ç½®åŒå‘ç»‘å®š
        if (stageNumber === 1) {
            setupStage1Binding(stageId);

            // åŒæ­¥é¡¶éƒ¨çš„è‡ªå®šä¹‰æŠ¤èº«ç¬¦åˆ°é˜¶æ®µ1
            syncTopCustomParamsToStage1();
        }

        // æ·»åŠ é¢„è®¾çš„è‡ªå®šä¹‰æŠ¤èº«ç¬¦ï¼ˆå¦‚æœæœ‰ï¼‰
        if (defaultData.customizedParams && defaultData.customizedParams.length > 0) {
            const container = document.getElementById(`stageCustomParams-${stageId}`);
            if (container) {
                defaultData.customizedParams.forEach(param => {
                    addStageCustomParamToContainer(container, param.name, param.value, param.times, false);
                });
            }
        }

        stageCounter++;
    }

    // è®¾ç½®é˜¶æ®µ1ä¸é¡¶éƒ¨å‚æ•°çš„åŒå‘ç»‘å®š
    function setupStage1Binding(stageId) {
        const stageElement = document.getElementById(stageId);

        // è·å–é˜¶æ®µ1çš„å…ƒç´ 
        const stageDyType = stageElement.querySelector('.dy-type');
        const stageFzType = stageElement.querySelector('.fz-type');
        const stageYgType = stageElement.querySelector('.yg-type');
        const stageBasicFan = stageElement.querySelector('.basic-fan');
        const stageBasicScore = stageElement.querySelector('.basic-score');
        const stageDyTimes = stageElement.querySelector('.dy-times');
        const stageFzTimes = stageElement.querySelector('.fz-times');
        const stageYgTimes = stageElement.querySelector('.yg-times');
        const stageEatFog = stageElement.querySelector('.eat-fog');
        const stageLoseFz = stageElement.querySelector('.lose-fz');
        const stageLoseYg = stageElement.querySelector('.lose-yg');
        const stageDyEnabled = stageElement.querySelector('.stage-dy-enabled');
        const stageFzEnabled = stageElement.querySelector('.stage-fz-enabled');
        const stageYgEnabled = stageElement.querySelector('.stage-yg-enabled');

        // é˜¶æ®µ1 -> é¡¶éƒ¨å‚æ•°
        stageDyType.addEventListener('change', () => document.getElementById('dy_type').value = stageDyType.value);
        stageFzType.addEventListener('change', () => document.getElementById('fz_type').value = stageFzType.value);
        stageYgType.addEventListener('change', () => document.getElementById('yg_type').value = stageYgType.value);
        stageBasicFan.addEventListener('input', () => document.getElementById('basicFan').value = stageBasicFan.value);
        stageBasicScore.addEventListener('input', () => document.getElementById('basicScore').value = stageBasicScore
            .value);
        stageDyTimes.addEventListener('input', () => document.getElementById('dy_times').value = stageDyTimes.value);
        stageFzTimes.addEventListener('input', () => document.getElementById('fz_times').value = stageFzTimes.value);
        stageYgTimes.addEventListener('input', () => document.getElementById('yg_times').value = stageYgTimes.value);
        stageEatFog.addEventListener('input', () => document.getElementById('eat_fog').value = stageEatFog.value);
        stageLoseFz.addEventListener('input', () => document.getElementById('lose_fz').value = stageLoseFz.value);
        stageLoseYg.addEventListener('input', () => document.getElementById('lose_yg').value = stageLoseYg.value);
        stageDyEnabled.addEventListener('change', () => document.getElementById('dyTalismanEnabled').checked =
            stageDyEnabled.checked);
        stageFzEnabled.addEventListener('change', () => document.getElementById('fzTalismanEnabled').checked =
            stageFzEnabled.checked);
        stageYgEnabled.addEventListener('change', () => document.getElementById('ygTalismanEnabled').checked =
            stageYgEnabled.checked);

        // é¡¶éƒ¨å‚æ•° -> é˜¶æ®µ1
        document.getElementById('dy_type').addEventListener('change', () => stageDyType.value = document.getElementById(
            'dy_type').value);
        document.getElementById('fz_type').addEventListener('change', () => stageFzType.value = document.getElementById(
            'fz_type').value);
        document.getElementById('yg_type').addEventListener('change', () => stageYgType.value = document.getElementById(
            'yg_type').value);
        document.getElementById('basicFan').addEventListener('input', () => stageBasicFan.value = document
            .getElementById('basicFan').value);
        document.getElementById('basicScore').addEventListener('input', () => stageBasicScore.value = document
            .getElementById('basicScore').value);
        document.getElementById('dy_times').addEventListener('input', () => stageDyTimes.value = document.getElementById(
            'dy_times').value);
        document.getElementById('fz_times').addEventListener('input', () => stageFzTimes.value = document.getElementById(
            'fz_times').value);
        document.getElementById('yg_times').addEventListener('input', () => stageYgTimes.value = document.getElementById(
            'yg_times').value);
        document.getElementById('eat_fog').addEventListener('input', () => stageEatFog.value = document.getElementById(
            'eat_fog').value);
        document.getElementById('lose_fz').addEventListener('input', () => stageLoseFz.value = document.getElementById(
            'lose_fz').value);
        document.getElementById('lose_yg').addEventListener('input', () => stageLoseYg.value = document.getElementById(
            'lose_yg').value);
        document.getElementById('dyTalismanEnabled').addEventListener('change', () => stageDyEnabled.checked = document
            .getElementById('dyTalismanEnabled').checked);
        document.getElementById('fzTalismanEnabled').addEventListener('change', () => stageFzEnabled.checked = document
            .getElementById('fzTalismanEnabled').checked);
        document.getElementById('ygTalismanEnabled').addEventListener('change', () => stageYgEnabled.checked = document
            .getElementById('ygTalismanEnabled').checked);
    }

    // åŒæ­¥é˜¶æ®µ1çš„å€¼åˆ°é¡¶éƒ¨ - ä¿®æ”¹ç‰ˆï¼ˆç¡®ä¿è‡ªå®šä¹‰æŠ¤èº«ç¬¦æ­£ç¡®åŒæ­¥ï¼‰
    function syncStage1ToTop(stageData) {
        document.getElementById('dy_type').value = stageData.dy_type;
        document.getElementById('fz_type').value = stageData.fz_type;
        document.getElementById('yg_type').value = stageData.yg_type;
        document.getElementById('basicFan').value = stageData.basicFan;
        document.getElementById('basicScore').value = stageData.basicScore;
        document.getElementById('dy_times').value = stageData.dy_times || 0;
        document.getElementById('fz_times').value = stageData.fz_times || 0;
        document.getElementById('yg_times').value = stageData.yg_times || 0;
        document.getElementById('eat_fog').value = stageData.eat_fog || 0;
        document.getElementById('lose_fz').value = stageData.lose_fz || 0;
        document.getElementById('lose_yg').value = stageData.lose_yg || 0;
        document.getElementById('dyTalismanEnabled').checked = stageData.dy_enabled;
        document.getElementById('fzTalismanEnabled').checked = stageData.fz_enabled;
        document.getElementById('ygTalismanEnabled').checked = stageData.yg_enabled;

        // æ›´æ–°é¡¶éƒ¨æŠ¤èº«ç¬¦æ˜¾ç¤ºçŠ¶æ€
        updateTopTalismanContent('dy', stageData.dy_enabled);
        updateTopTalismanContent('fz', stageData.fz_enabled);
        updateTopTalismanContent('yg', stageData.yg_enabled);

        // åŒæ­¥è‡ªå®šä¹‰æŠ¤èº«ç¬¦
        syncStage1CustomParamsToTop();
    }

    // åˆ é™¤é˜¶æ®µ - ä¿®æ”¹ç‰ˆï¼ˆåˆ é™¤ç¬¬ä¸€ä¸ªé˜¶æ®µååŒæ­¥æ–°é˜¶æ®µ1åˆ°ä¸Šæ–¹ï¼Œæ— é˜¶æ®µæ—¶ä¿æŒä¸Šæ–¹å‚æ•°ä¸å˜ï¼‰
    function removeStage(stageId) {
        const element = document.getElementById(stageId);
        if (element) {
            const isFirstStage = element.id === 'stage1';
            element.remove();

            // é‡æ–°ç¼–å·æ‰€æœ‰é˜¶æ®µ
            renumberStages();

            // å¦‚æœåˆ é™¤çš„æ˜¯ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œå¹¶ä¸”æœ‰æ–°çš„é˜¶æ®µ1ï¼Œåˆ™åŒæ­¥åˆ°ä¸Šæ–¹
            if (isFirstStage) {
                const newFirstStage = document.querySelector('.strategy-stage');
                if (newFirstStage) {
                    syncStage1ToTop(getStageData(newFirstStage));
                }
                // å¦‚æœæ²¡æœ‰é˜¶æ®µäº†ï¼Œä¿æŒä¸Šæ–¹å‚æ•°ä¸å˜
            }
        }
    }

    // è·å–é˜¶æ®µçš„å®Œæ•´æ•°æ®
    function getStageData(stageElement) {
        const customizedParams = getStageCustomParamsData(stageElement);

        return {
            name: stageElement.querySelector('.stage-name').value,
            actualLevel: parseInt(stageElement.querySelector('.actual-level').value) || 0,
            dy_type: stageElement.querySelector('.dy-type').value,
            fz_type: stageElement.querySelector('.fz-type').value,
            yg_type: stageElement.querySelector('.yg-type').value,
            basicFan: parseInt(stageElement.querySelector('.basic-fan').value),
            basicScore: parseInt(stageElement.querySelector('.basic-score').value),
            dy_times: parseInt(stageElement.querySelector('.dy-times').value),
            fz_times: parseInt(stageElement.querySelector('.fz-times').value),
            yg_times: parseInt(stageElement.querySelector('.yg-times').value),
            eat_fog: parseInt(getValueOrDefault(stageElement.querySelector('.eat-fog').value, 0)),
            lose_fz: parseInt(getValueOrDefault(stageElement.querySelector('.lose-fz').value, 0)),
            lose_yg: parseInt(getValueOrDefault(stageElement.querySelector('.lose-yg').value, 0)),
            dy_enabled: stageElement.querySelector('.stage-dy-enabled').checked,
            fz_enabled: stageElement.querySelector('.stage-fz-enabled').checked,
            yg_enabled: stageElement.querySelector('.stage-yg-enabled').checked,
            customizedParams: customizedParams
        };
    }

    // é‡æ–°ç¼–å·é˜¶æ®µ - ä¿®æ”¹ç‰ˆï¼ˆç¡®ä¿é˜¶æ®µ1æ­£ç¡®ç»‘å®šï¼‰
    function renumberStages() {
        const stages = document.querySelectorAll('.strategy-stage');
        stageCounter = 1;
        stages.forEach((stage, index) => {
            const title = stage.querySelector('.stage-title');
            const nameInput = stage.querySelector('.stage-name');
            const newStageId = `stage${index + 1}`;

            // æ›´æ–°é˜¶æ®µID
            stage.id = newStageId;

            // æ›´æ–°é˜¶æ®µæ ‡é¢˜
            title.textContent = `é˜¶æ®µ ${index + 1}`;

            // æ›´æ–°é˜¶æ®µåç§°ï¼ˆå¦‚æœæ˜¯é»˜è®¤åç§°ï¼‰
            if (nameInput.value === `é˜¶æ®µ${stageCounter}` || nameInput.value.includes('é˜¶æ®µ')) {
                nameInput.value = `é˜¶æ®µ${index + 1}`;
            }

            // æ›´æ–°è‡ªå®šä¹‰æŠ¤èº«ç¬¦å®¹å™¨çš„ID
            const customParamsContainer = stage.querySelector('.stage-custom-params-container');
            if (customParamsContainer) {
                customParamsContainer.id = `stageCustomParams-${newStageId}`;
            }

            // æ›´æ–°åˆ é™¤æŒ‰é’®çš„onclickäº‹ä»¶
            const removeButton = stage.querySelector('.remove-stage');
            if (removeButton) {
                removeButton.setAttribute('onclick', `removeStage('${newStageId}')`);
            }

            // æ›´æ–°æ·»åŠ è‡ªå®šä¹‰æŠ¤èº«ç¬¦æŒ‰é’®çš„onclickäº‹ä»¶
            const addCustomParamButton = stage.querySelector('.add-stage-custom-param-btn');
            if (addCustomParamButton) {
                addCustomParamButton.setAttribute('onclick', `addStageCustomParam('${newStageId}')`);
            }

            // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œé‡æ–°è®¾ç½®åŒå‘ç»‘å®š
            if (index === 0) {
                setupStage1Binding(newStageId);
            }

            stageCounter++;
        });
    }

    // è·å–æ‰€æœ‰é˜¶æ®µé…ç½®
    function getAllStages() {
        const stages = [];
        const stageElements = document.querySelectorAll('.strategy-stage');

        stageElements.forEach((stageElement) => {
            const stageId = stageElement.id;
            const customizedParams = getStageCustomizedParams(stageId);

            const stageData = {
                name: stageElement.querySelector('.stage-name').value,
                actualLevel: parseInt(stageElement.querySelector('.actual-level').value) || 0,
                dy_type: stageElement.querySelector('.dy-type').value,
                fz_type: stageElement.querySelector('.fz-type').value,
                yg_type: stageElement.querySelector('.yg-type').value,
                basicFan: parseInt(stageElement.querySelector('.basic-fan').value),
                basicScore: parseInt(stageElement.querySelector('.basic-score').value),
                dy_times: parseInt(stageElement.querySelector('.dy-times').value),
                fz_times: parseInt(stageElement.querySelector('.fz-times').value),
                yg_times: parseInt(stageElement.querySelector('.yg-times').value),
                eat_fog: parseInt(getValueOrDefault(stageElement.querySelector('.eat-fog').value, 0)),
                lose_fz: parseInt(getValueOrDefault(stageElement.querySelector('.lose-fz').value, 0)),
                lose_yg: parseInt(getValueOrDefault(stageElement.querySelector('.lose-yg').value, 0)),
                dy_enabled: stageElement.querySelector('.stage-dy-enabled').checked,
                fz_enabled: stageElement.querySelector('.stage-fz-enabled').checked,
                yg_enabled: stageElement.querySelector('.stage-yg-enabled').checked,
                customizedParams: customizedParams
            };

            stages.push(stageData);
        });

        return stages;
    }

    // è·å–é˜¶æ®µè‡ªå®šä¹‰æŠ¤èº«ç¬¦å‚æ•°
    function getStageCustomizedParams(stageId) {
        const container = document.getElementById(`stageCustomParams-${stageId}`);
        if (!container) return [];

        const customParams = [];
        const customParamGroups = container.querySelectorAll('.stage-custom-param-group');

        customParamGroups.forEach((group, index) => {
            const timesInput = group.querySelector('.stage-custom-param-times');
            const valueInput = group.querySelector('.stage-custom-param-value');

            if (valueInput && timesInput) {
                try {
                    const value = parseValue(valueInput.value);
                    const times = parseInt(timesInput.value) || 0;

                    if (value && !isNaN(times)) {
                        customParams.push({
                            value: value,
                            times: times
                        });
                    }
                } catch (error) {
                    console.error('è§£æé˜¶æ®µè‡ªå®šä¹‰å‚æ•°é”™è¯¯:', error);
                }
            }
        });

        return customParams;
    }

    // è·å–æ‰€æœ‰è‡ªå®šä¹‰æŠ¤èº«ç¬¦å‚æ•°
    function getCustomizedParams() {
        const customParams = [];
        const customParamGroups = document.querySelectorAll('.custom-param-group');

        customParamGroups.forEach((group, index) => {
            const timesInput = group.querySelector('.custom-param-times');
            const valueInput = group.querySelector('.custom-param-value');
            const nameInput = group.querySelector('.custom-param-name');

            if (valueInput && timesInput && nameInput) {
                try {
                    const value = parseValue(valueInput.value);
                    const times = parseInt(timesInput.value) || 0;
                    const name = nameInput.value;

                    if (value && !isNaN(times)) {
                        customParams.push({
                            name: name,
                            value: value,
                            times: times
                        });
                    }
                } catch (error) {
                    console.error('è§£æè‡ªå®šä¹‰å‚æ•°é”™è¯¯:', error);
                }
            }
        });

        return customParams;
    }

    // è†¨èƒ€ç›—å°è†¨èƒ€è´Ÿé‡æ™®é€šæœˆå…‰ç­–ç•¥é…ç½®
    const twoInflationStrategy = [{
        name: "æ”¹ä¼ å¯¼å¡ç»´",
        actualLevel: 0,
        dy_type: "å¡ç»´è†¨èƒ€ç›—å°",
        fz_type: "è†¨èƒ€è´Ÿé‡",
        yg_type: "æ™®é€šæœˆå…‰",
        basicFan: 19,
        basicScore: 38,
        dy_times: 2,
        fz_times: 2,
        yg_times: 1,
        eat_fog: 0,
        lose_fz: 0,
        lose_yg: 0,
        dy_enabled: true,
        fz_enabled: true,
        yg_enabled: true
    },
        {
            name: "æ”¹å²šæ˜Ÿ",
            actualLevel: 0,
            dy_type: "å…¶ä»–å¡è†¨èƒ€ç›—å°",
            fz_type: "è†¨èƒ€è´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 23,
            basicScore: 38,
            dy_times: 2,
            fz_times: 2,
            yg_times: 1,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "å²šæ˜Ÿå…¥é“¾",
            actualLevel: 0,
            dy_type: "å…¶ä»–å¡è†¨èƒ€ç›—å°",
            fz_type: "è†¨èƒ€è´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 23,
            basicScore: 38,
            dy_times: 3,
            fz_times: 2,
            yg_times: 1,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "æœˆå…‰å…¥é“¾",
            actualLevel: 0,
            dy_type: "å…¶ä»–å¡è†¨èƒ€ç›—å°",
            fz_type: "è†¨èƒ€è´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 23,
            basicScore: 38,
            dy_times: 3,
            fz_times: 2,
            yg_times: 3,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "ç›—å°å…¥é“¾",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "è†¨èƒ€è´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 23,
            basicScore: 100000,
            dy_times: 4,
            fz_times: 2,
            yg_times: 3,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "å¤©æ©å…¥é“¾",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "è†¨èƒ€è´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 23,
            basicScore: 100000,
            dy_times: 5,
            fz_times: 2,
            yg_times: 4,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "å¤©æ©ç§»åˆ°ç›—å°å‰é¢",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "è†¨èƒ€è´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 23,
            basicScore: 100000,
            dy_times: 6,
            fz_times: 2,
            yg_times: 4,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "å¤©æ©ç§»åˆ°æœˆå…‰å‰é¢",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "è†¨èƒ€è´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 23,
            basicScore: 100000,
            dy_times: 6,
            fz_times: 2,
            yg_times: 5,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "è´Ÿé‡å…¥é“¾",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 23,
            basicScore: 100000,
            dy_times: 5,
            fz_times: 6,
            yg_times: 4,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "å¤©æ©ç§»åˆ°è´Ÿé‡å‰é¢",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 23,
            basicScore: 100000,
            dy_times: 5,
            fz_times: 7,
            yg_times: 4,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "å¤©æ©ç§»åˆ°ç›—å°å‰é¢",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 23,
            basicScore: 100000,
            dy_times: 6,
            fz_times: 7,
            yg_times: 4,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "å¤©æ©ç§»åˆ°æœˆå…‰å‰é¢",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 23,
            basicScore: 100000,
            dy_times: 6,
            fz_times: 7,
            yg_times: 5,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "å…«é“¾æˆå‹",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 23,
            basicScore: 100000,
            dy_times: 6,
            fz_times: 8,
            yg_times: 5,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "å¤©æ©ç§»åˆ°ç›—å°å‰é¢",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 23,
            basicScore: 100000,
            dy_times: 7,
            fz_times: 8,
            yg_times: 5,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "æœ€ç»ˆé˜¶æ®µï¼šå¤©æ©ç§»åˆ°æœˆå…‰å‰é¢",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 23,
            basicScore: 100000,
            dy_times: 7,
            fz_times: 8,
            yg_times: 6,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        }
    ];

    // åº”ç”¨è†¨èƒ€ç›—å°è†¨èƒ€è´Ÿé‡æ™®é€šæœˆå…‰ç­–ç•¥
    function applyTwoInflationStrategy() {
        // æ¸…é™¤æ‰€æœ‰ç°æœ‰é˜¶æ®µ
        document.getElementById('strategyStagesContainer').innerHTML = '';
        stageCounter = 1;

        // æ·»åŠ æ–°é˜¶æ®µ
        twoInflationStrategy.forEach(stageData => {
            addStrategyStage(stageData);
        });

        syncStage1ToTop(twoInflationStrategy[0]);

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        alert("æ­¤ä¸ºè†¨èƒ€ç›—å°+è†¨èƒ€è´Ÿé‡+æ™®é€šæœˆå…‰çš„æ ‡å‡†ç­–ç•¥ï¼›\né˜¶æ®µ2çš„å®é™…å¼€å§‹å…³å¡å°±æ˜¯æ”¹å‡ºä¼ å¯¼å¡ç»´çš„é‚£å…³ï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºæ²¡æ”¹å‡ºä¼ å¯¼å¡ç»´ï¼Œå°±ä¸ä¼šæ‰§è¡Œåç»­é˜¶æ®µäº†ï¼›\nå¸æ˜ŸæŒ‰ç…§1ä¸‡æ˜Ÿå¸æ¥ç®—");
    }

    // å•ç›—å°é»‘å®¢ç­–ç•¥é…ç½®
    const singleDyHackerStrategy = [
        {
            name: "å¡ç»´+è†¨èƒ€ç›—å°+é»‘å®¢",
            actualLevel: 0,
            dy_type: "é»‘å®¢åªå˜ç›—å°",
            basicFan: 19,
            basicScore: 38,
            dy_times: 3,
            eat_fog: 0,
            dy_enabled: true,
            fz_enabled: false,
            yg_enabled: false
        },
        {
            name: "å¼€å§‹åˆ·ä¼ å¯¼å¡ç»´",
            actualLevel: 0,
            dy_type: "å…¶ä»–å¡è†¨èƒ€ç›—å°",
            basicFan: 19,
            basicScore: 38,
            dy_times: 3,
            eat_fog: 0,
            dy_enabled: true,
            fz_enabled: false,
            yg_enabled: false
        },
        {
            name: "å¤©æ©å…¥é“¾",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "è†¨èƒ€è´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 19,
            basicScore: 38,
            dy_times: 4,
            eat_fog: 0,
            dy_enabled: true,
            fz_enabled: false,
            yg_enabled: false
        },
        {
            name: "è´Ÿé‡å…¥é“¾",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            basicFan: 19,
            basicScore: 38,
            dy_times: 5,
            fz_times: 4,
            eat_fog: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: false
        },
        {
            name: "å¸æ˜Ÿå…¥é“¾",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            basicFan: 19,
            basicScore: 100000,
            dy_times: 6,
            fz_times: 5,
            eat_fog: 0,
            lose_fz: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: false
        },
        {
            name: "æœˆå…‰å…¥é“¾",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 19,
            basicScore: 100000,
            dy_times: 7,
            fz_times: 6,
            yg_times: 5,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "8é“¾æˆå‹",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 19,
            basicScore: 100000,
            dy_times: 8,
            fz_times: 7,
            yg_times: 6,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        }
    ];

    // åº”ç”¨å•ç›—å°é»‘å®¢ç­–ç•¥
    function applySingleDyHackerStrategy() {
        // æ¸…é™¤æ‰€æœ‰ç°æœ‰é˜¶æ®µ
        document.getElementById('strategyStagesContainer').innerHTML = '';
        stageCounter = 1;

        // æ·»åŠ æ–°é˜¶æ®µ
        singleDyHackerStrategy.forEach(stageData => {
            addStrategyStage(stageData);
        });

        syncStage1ToTop(singleDyHackerStrategy[0]);

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        alert("æ­¤ä¸ºå•ç›—å°é»‘å®¢åŸºç¡€ç­–ç•¥" +
            "\nè½¬åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µçš„å®é™…å¼€å§‹å…³å¡éœ€è¦è‡ªå·±æ ¹æ®å®é™…æƒ…å†µå¡«å†™ï¼›\nå¸æ˜Ÿå…¥é“¾æŒ‰1ä¸‡æ˜Ÿå¸æ¥ç®—ï¼›\nä¸è€ƒè™‘å¤©æ©å¾€å‰ç§»çš„æ­¥éª¤");
    }

    // è†¨èƒ€ç›—å°è†¨èƒ€è´Ÿé‡é»‘å®¢ç­–ç•¥é…ç½®
    const inflationDyFzHackerStrategy = [
        {
            name: "ä¸¤æŒ‡æ•°é»‘å®¢",
            actualLevel: 0,
            dy_type: "å¡ç»´è†¨èƒ€ç›—å°",
            fz_type: "è†¨èƒ€è´Ÿé‡",
            basicFan: 19,
            basicScore: 38,
            dy_times: 2,
            fz_times: 3,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: false
        },
        {
            name: "åˆ·ä¼ å¯¼å¡ç»´",
            actualLevel: 0,
            dy_type: "å…¶ä»–å¡è†¨èƒ€ç›—å°",
            fz_type: "è†¨èƒ€è´Ÿé‡",
            basicFan: 19,
            basicScore: 38,
            dy_times: 3,
            fz_times: 2,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: false
        },
        {
            name: "ç›—å°å…¥é“¾",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "è†¨èƒ€è´Ÿé‡",
            basicFan: 19,
            basicScore: 38,
            dy_times: 4,
            fz_times: 3,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: false
        },
        {
            name: "æœˆå…‰å¸æ˜Ÿå…¥é“¾ï¼Œå¤©æ©æ”¾åé¢",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "è†¨èƒ€è´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 19,
            basicScore: 2000000,
            dy_times: 5,
            fz_times: 3,
            yg_times: 4,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "å¤©æ©ç§»åˆ°æœˆå…‰å‰é¢",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "è†¨èƒ€è´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 19,
            basicScore: 2000000,
            dy_times: 6,
            fz_times: 3,
            yg_times: 5,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true
        },
        {
            name: "è´Ÿé‡ç³ç…å…¥é“¾ï¼Œå¤©æ©æ”¾åé¢",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 19,
            basicScore: 2000000,
            dy_times: 7,
            fz_times: 6,
            yg_times: 5,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 1,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true,
            customizedParams: [
                {name: "ç³ç…", value: "1000", times: 4}
            ]
        },
        {
            name: "å¤©æ©ç§»åˆ°ç›—å°å‰é¢",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 19,
            basicScore: 2000000,
            dy_times: 8,
            fz_times: 6,
            yg_times: 5,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true,
            customizedParams: [
                {name: "ç³ç…", value: "1000", times: 4}
            ]
        },
        {
            name: "å¤©æ©ç§»åˆ°è´Ÿé‡å‰é¢",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 19,
            basicScore: 2000000,
            dy_times: 8,
            fz_times: 7,
            yg_times: 5,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true,
            customizedParams: [
                {name: "ç³ç…", value: "1000", times: 4}
            ]
        },
        {
            name: "æœ€ç»ˆ8é“¾ï¼Œå¤©æ©ç§»åˆ°ç³ç…å‰é¢",
            actualLevel: 0,
            dy_type: "æ™®é€šç›—å°",
            fz_type: "æ™®é€šè´Ÿé‡",
            yg_type: "æ™®é€šæœˆå…‰",
            basicFan: 19,
            basicScore: 2000000,
            dy_times: 8,
            fz_times: 7,
            yg_times: 6,
            eat_fog: 0,
            lose_fz: 0,
            lose_yg: 0,
            dy_enabled: true,
            fz_enabled: true,
            yg_enabled: true,
            customizedParams: [
                {name: "ç³ç…", value: "1500", times: 5}
            ]
        }
    ];

    // åº”ç”¨è†¨èƒ€ç›—å°è†¨èƒ€è´Ÿé‡é»‘å®¢ç­–ç•¥
    function applyInflationDyFzHackerStrategy() {
        // æ¸…é™¤æ‰€æœ‰ç°æœ‰é˜¶æ®µ
        document.getElementById('strategyStagesContainer').innerHTML = '';
        stageCounter = 1;

        // æ·»åŠ æ–°é˜¶æ®µ
        inflationDyFzHackerStrategy.forEach(stageData => {
            addStrategyStage(stageData);
        });

        syncStage1ToTop(inflationDyFzHackerStrategy[0]);

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        alert("æ­¤ä¸ºä¸¤æŒ‡æ•°é»‘å®¢çš„ä¸€ç§ç­–ç•¥\n1.é»‘å®¢å˜ç›—å°æ˜¯éšæœºçš„ï¼Œæ‰€ä»¥ç›—å°çš„æˆé•¿ä¸èƒ½å¾—åˆ°å‡†ç¡®å€¼ï¼Œæœ€ä½³å®è·µï¼šå»ºè®®45å…³çš„æ—¶å€™è¾“å…¥å‚æ•°è®¡ç®—ä¸€ä¸‹æé™å…³å¡ï¼Œç„¶ååœ¨å–é»‘å®¢ä¹‹å‰ç”¨åƒè¿·é›¾æ¬¡æ•°æ¥ä¿®æ­£æ•°æ®ï¼Œå°±èƒ½çŸ¥é“å“ªä¸€å…³æ‰¾å²šæ˜Ÿï¼Œå“ªä¸€å…³å¼€å§‹åˆ·ä¼ å¯¼å¡ç»´\n" +
            "2.åˆ·ä¼ å¯¼å¡ç»´çš„å®é™…å¼€å§‹å…³å¡éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥å¡«\nç›—å°å…¥é“¾åï¼Œä»¥æ‰¾åˆ°å¤©æ©ç»§ç»­åç»­é˜¶æ®µï¼Œå¦‚æœæ˜¯å…¶ä»–ä¹˜Nç•ªå¡ï¼Œéœ€è¦è‡ªå·±ä¿®æ”¹ç­–ç•¥\n3.æ­¤ç­–ç•¥é¢„è®¾çš„æ˜¯æœˆå…‰ç›´æ¥å…¥é“¾ï¼Œæœˆå…‰å¸æ˜Ÿå…¥é“¾çš„å®é™…å¼€å§‹å…³å¡éœ€è¦è‡ªå·±æ ¹æ®å®é™…æƒ…å†µæ¥å¡«\n" +
            "4.å¦‚æœæœ‰å²šæ˜ŸPlusï¼Œå¯ä»¥åˆ·å¤©ä½¿æœˆå…‰ï¼Œæœˆå…‰æœ€åå…¥é“¾èƒ½å¤šå¤§çº¦4å…³ï¼Œåˆ™éœ€è¦ä¿®æ”¹æ­¤ç­–ç•¥\n5.è´Ÿé‡å…¥é“¾åï¼Œæ­¤ç­–ç•¥æ˜¯ç›´æ¥å–å¸æ˜Ÿæ‰¾ç³ç…ï¼Œäºä¸€æ¬¡æœˆå…‰ï¼Œå¦‚æœæ˜¯å…¶ä»–ä¹˜Nç•ªå¡ï¼Œéœ€è¦è‡ªå·±æ ¹æ®æƒ…å†µä¿®æ”¹æ­¤ç­–ç•¥");
    }

    // å…³å¡åˆ†æ•°æ•°æ®
    const LEVEL_SCORE_DATA = [
        {level: "Ex1", score: "1.00E+06"},
        {level: "Ex2", score: "1.20E+07"},
        {level: "Ex3", score: "9.08E+07"},
        {level: "Ex4", score: "8.11E+08"},
        {level: "Ex5", score: "8.43E+09"},
        {level: "Ex6", score: "1.00E+11"},
        {level: "Ex7", score: "1.35E+12"},
        {level: "Ex8", score: "2.06E+13"},
        {level: "Ex9", score: "3.48E+14"},
        {level: "Ex10", score: "6.54E+15"},
        {level: "Ex11", score: "1.36E+17"},
        {level: "Ex12", score: "3.09E+18"},
        {level: "Ex13", score: "7.68E+19"},
        {level: "Ex14", score: "2.08E+21"},
        {level: "Ex15", score: "6.64E+22"},
        {level: "Ex16", score: "2.46E+24"},
        {level: "Ex17", score: "1.05E+26"},
        {level: "Ex18", score: "5.15E+27"},
        {level: "Ex19", score: "2.82E+29"},
        {level: "Ex20", score: "1.83E+31"},
        {level: "Ex21", score: "1.31E+33"},
        {level: "Ex22", score: "1.07E+35"},
        {level: "Ex23", score: "9.72E+36"},
        {level: "Ex24", score: "9.94E+38"},
        {level: "Ex25", score: "1.14E+41"},
        {level: "Ex26", score: "1.46E+43"},
        {level: "Ex27", score: "2.08E+45"},
        {level: "Ex28", score: "3.31E+47"},
        {level: "Ex29", score: "5.85E+49"},
        {level: "Ex30", score: "1.26E+52"},
        {level: "Ex31", score: "3.00E+54"},
        {level: "Ex32", score: "8.71E+56"},
        {level: "Ex33", score: "2.79E+59"},
        {level: "Ex34", score: "1.08E+62"},
        {level: "Ex35", score: "4.63E+64"},
        {level: "Ex36", score: "2.40E+67"},
        {level: "Ex37", score: "1.37E+70"},
        {level: "Ex38", score: "9.41E+72"},
        {level: "Ex39", score: "7.15E+75"},
        {level: "Ex40", score: "7.09E+78"},
        {level: "Ex41", score: "9.17E+81"},
        {level: "Ex42", score: "1.55E+85"},
        {level: "Ex43", score: "3.40E+88"},
        {level: "Ex44", score: "9.73E+91"},
        {level: "Ex45", score: "3.63E+95"},
        {level: "Ex46", score: "1.11E+99"},
        {level: "Ex47", score: "1.11E+103"},
        {level: "Ex48", score: "9.11E+106"},
        {level: "Ex49", score: "9.72E+110"},
        {level: "Ex50", score: "1.35E+115"},
        {level: "Ex51", score: "2.81E+119"},
        {level: "Ex52", score: "8.79E+123"},
        {level: "Ex53", score: "4.12E+128"},
        {level: "Ex54", score: "2.90E+134"},
        {level: "Ex55", score: "3.06E+138"},
        {level: "Ex56", score: "4.84E+143"},
        {level: "Ex57", score: "1.15E+149"},
        {level: "Ex58", score: "4.10E+154"},
        {level: "Ex59", score: "2.19E+160"},
        {level: "Ex60", score: "1.76E+166"},
        {level: "Ex61", score: "2.11E+172"},
        {level: "Ex62", score: "3.80E+178"},
        {level: "Ex63", score: "1.03E+185"},
        {level: "Ex64", score: "4.17E+191"},
        {level: "Ex65", score: "2.54E+198"},
        {level: "Ex66", score: "2.32E+205"},
        {level: "Ex67", score: "3.18E+212"},
        {level: "Ex68", score: "6.54E+219"},
        {level: "Ex69", score: "2.02E+227"},
        {level: "Ex70", score: "9.31E+234"},
        {level: "Ex71", score: "6.46E+242"},
        {level: "Ex72", score: "6.72E+250"},
        {level: "Ex73", score: "1.05E+259"},
        {level: "Ex74", score: "2.45E+267"},
        {level: "Ex75", score: "8.60E+275"},
        {level: "Ex76", score: "4.53E+284"},
        {level: "Ex77", score: "3.58E+293"},
        {level: "Ex78", score: "4.24E+302"},
        {level: "Ex79", score: "5.7E310"},
        {level: "Ex80", score: "5.7E318"},
        {level: "Ex81", score: "5.7E326"},
        {level: "Ex82", score: "5.7E334"},
        {level: "Ex83", score: "5.7E342"},
        {level: "Ex84", score: "5.7E350"},
        {level: "Ex85", score: "5.7E359"},
        {level: "Ex86", score: "5.7E368"},
        {level: "Ex87", score: "5.7E377"},
        {level: "Ex88", score: "5.7E386"},
        {level: "Ex89", score: "5.7E395"},
        {level: "Ex90", score: "5.7E405"},
        {level: "Ex91", score: "5.7E415"},
        {level: "Ex92", score: "5.7E425"},
        {level: "Ex93", score: "5.7E435"},
        {level: "Ex94", score: "5.7E445"},
        {level: "Ex95", score: "5.7E455"},
        {level: "Ex96", score: "5.7E466"},
        {level: "Ex97", score: "5.7E477"},
        {level: "Ex98", score: "5.7E488"},
        {level: "Ex99", score: "5.7E499"},
        {level: "Ex100", score: "9.999E510"},
        {level: "Ex101", score: "9.999E522"},
        {level: "Ex102", score: "9.999E534"},
        {level: "Ex103", score: "9.999E546"},
        {level: "Ex104", score: "9.999E558"},
        {level: "Ex105", score: "9.999E571"},
        {level: "Ex106", score: "9.999E584"},
        {level: "Ex107", score: "9.999E597"},
        {level: "Ex108", score: "9.999E611"},
        {level: "Ex109", score: "9.999E625"},
        {level: "Ex110", score: "9.999E639"},
        {level: "Ex111", score: "9.999E654"},
        {level: "Ex112", score: "9.999E669"},
        {level: "Ex113", score: "9.999E684"},
        {level: "Ex114", score: "9.999E699"},
        {level: "Ex115", score: "9.999E715"},
        {level: "Ex116", score: "9.999E731"},
        {level: "Ex117", score: "9.999E748"},
        {level: "Ex118", score: "9.999E765"},
        {level: "Ex119", score: "9.999E783"},
        {level: "Ex120", score: "9.999E801"},
        {level: "Ex121", score: "9.999E820"},
        {level: "Ex122", score: "9.999E839"},
        {level: "Ex123", score: "9.999E859"},
        {level: "Ex124", score: "9.999E879"},
        {level: "Ex125", score: "9.999E900"},
        {level: "Ex126", score: "9.999E921"},
        {level: "Ex127", score: "9.999E943"},
        {level: "Ex128", score: "9.999E966"},
        {level: "Ex129", score: "9.999E990"},
        {level: "Ex130", score: "9.999E1015"},
        {level: "Ex131", score: "9.999E1041"},
        {level: "Ex132", score: "9.999E1068"},
        {level: "Ex133", score: "9.999E1096"},
        {level: "Ex134", score: "2.9997E1126"},
        {level: "Ex135", score: "9.999E1155"},
        {level: "Ex136", score: "9.999E1186"},
        {level: "Ex137", score: "9.999E1218"},
        {level: "Ex138", score: "9.999E1251"},
        {level: "Ex139", score: "9.999E1285"},
        {level: "Ex140", score: "9.999E1320"},
        {level: "Ex141", score: "9.999E1356"},
        {level: "Ex142", score: "9.999E1393"},
        {level: "Ex143", score: "9.999E1431"},
        {level: "Ex144", score: "9.999E1470"},
        {level: "Ex145", score: "9.999E1510"},
        {level: "Ex146", score: "9.999E1551"},
        {level: "Ex147", score: "9.999E1593"},
        {level: "Ex148", score: "9.999E1636"},
        {level: "Ex149", score: "9.999E1680"},
        {level: "Ex150", score: "2.9997E1726"},
        {level: "Ex151", score: "9.999E1771"},
        {level: "Ex152", score: "9.999E1818"},
        {level: "Ex153", score: "2.9997E1867"},
        {level: "Ex154", score: "9.999E1915"},
        {level: "Ex155", score: "9.999E1965"},
        {level: "Ex156", score: "9.999E2016"},
        {level: "Ex157", score: "9.999E2068"},
        {level: "Ex158", score: "2.9997E2122"},
        {level: "Ex159", score: "9.999E2175"},
        {level: "Ex160", score: "9.999E2230"},
        {level: "Ex161", score: "9.999E2286"},
        {level: "Ex162", score: "9.999E2343"},
        {level: "Ex163", score: "9.999E2401"},
        {level: "Ex164", score: "9.999E2460"}
    ];

    // åˆå§‹åŒ–å…³å¡åˆ†æ•°è¡¨æ ¼
    function initScoreTable() {
        const tableBody = document.querySelector('#scoreTable tbody');
        tableBody.innerHTML = '';

        LEVEL_SCORE_DATA.forEach(data => {
            const row = document.createElement('tr');
            row.innerHTML = `
            <td>${data.level}</td>
            <td>${data.score}</td>
        `;
            tableBody.appendChild(row);
        });
    }

    // å…³å¡åˆ†æ•°è¡¨æ ¼åˆ‡æ¢åŠŸèƒ½
    function setupScoreTableToggle() {
        document.getElementById('toggleScoreTable').addEventListener('click', function () {
            const tableContainer = document.querySelector('.score-table-container');
            const eye = document.getElementById('toggleScoreTable');

            if (tableContainer.classList.contains('hidden')) {
                // æ˜¾ç¤ºè¡¨æ ¼
                tableContainer.classList.remove('hidden');
                eye.textContent = "ğŸ‘ï¸"; // ççœ¼å›¾æ ‡
                eye.title = "ç‚¹å‡»éšè—è¡¨æ ¼";
            } else {
                // éšè—è¡¨æ ¼
                tableContainer.classList.add('hidden');
                eye.textContent = "ğŸ™ˆ"; // é—­çœ¼å›¾æ ‡
                eye.title = "ç‚¹å‡»æ˜¾ç¤ºè¡¨æ ¼";
            }
        });
    }

    // å•ä½è½¬æ¢åŠŸèƒ½
    function setupUnitConverter() {
        // åˆ‡æ¢æ˜¾ç¤º/éšè—
        document.getElementById('toggleUnitConverter').addEventListener('click', function () {
            const container = document.querySelector('.unit-converter-container');
            const eye = document.getElementById('toggleUnitConverter');

            if (container.classList.contains('hidden')) {
                container.classList.remove('hidden');
                eye.textContent = "ğŸ‘ï¸";
                eye.title = "ç‚¹å‡»éšè—è½¬æ¢å™¨";
            } else {
                container.classList.add('hidden');
                eye.textContent = "ğŸ™ˆ";
                eye.title = "ç‚¹å‡»æ˜¾ç¤ºè½¬æ¢å™¨";
            }
        });

        // è½¬æ¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('convertUnitBtn').addEventListener('click', convertUnit);

        // è¾“å…¥æ¡†å›è½¦äº‹ä»¶
        document.getElementById('unitInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                convertUnit();
            }
        });
    }

    // å•ä½è½¬æ¢å‡½æ•°
    function convertUnit() {
        const input = document.getElementById('unitInput').value.trim();
        const resultElement = document.getElementById('conversionResult');

        if (!input) {
            resultElement.textContent = "è¯·è¾“å…¥è¦è½¬æ¢çš„å•ä½å€¼";
            resultElement.style.color = "#e74c3c";
            return;
        }

        try {
            const result = parseComplexUnit(input);
            resultElement.textContent = formatScientific(result);
            resultElement.style.color = "#27ae60";
        } catch (error) {
            resultElement.textContent = `è½¬æ¢é”™è¯¯: ${error.message}`;
            resultElement.style.color = "#e74c3c";
        }
    }

    // è§£æå¤æ‚å•ä½ï¼ˆæ”¯æŒè¿ç»­å•ä½å¦‚"æ¶§æææææ"ï¼‰
    function parseComplexUnit(input) {
        // å…ˆå°è¯•ç›´æ¥è§£æ
        try {
            return parseValue(input);
        } catch (e) {
            // å¦‚æœç›´æ¥è§£æå¤±è´¥ï¼Œå°è¯•è§£æè¿ç»­å•ä½
        }

        // åŒ¹é…æ•°å­—éƒ¨åˆ†å’Œå•ä½éƒ¨åˆ†
        const match = input.match(/^([\d.]+)([\u4e00-\u9fa5]+)$/);
        if (!match) {
            throw new Error('è¾“å…¥æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä½¿ç”¨"æ•°å­—+å•ä½"æ ¼å¼ï¼Œå¦‚"117.99æ¶§"');
        }

        const numericPart = match[1];
        const unitPart = match[2];

        // è§£ææ•°å­—éƒ¨åˆ†
        const numericValue = new Decimal(numericPart);

        // è§£æå•ä½éƒ¨åˆ†ï¼ˆæ”¯æŒè¿ç»­å•ä½ï¼‰
        let totalMagnitude = 0;
        for (let i = 0; i < unitPart.length; i++) {
            const unitChar = unitPart[i];
            if (MAGNITUDE_MAP.hasOwnProperty(unitChar)) {
                totalMagnitude += MAGNITUDE_MAP[unitChar];
            } else {
                throw new Error(`æœªçŸ¥å•ä½: "${unitChar}"`);
            }
        }

        // è®¡ç®—æœ€ç»ˆå€¼
        return numericValue.times(Decimal.pow(10, totalMagnitude));
    }

    // æ·»åŠ å¿«æ·é”®æ¨¡å—åˆ‡æ¢åŠŸèƒ½
    function setupShortcutModuleToggle() {
        document.getElementById('toggleShortcutModule').addEventListener('click', function () {
            const container = document.querySelector('.shortcut-module-container');
            const eye = document.getElementById('toggleShortcutModule');

            if (container.classList.contains('hidden')) {
                container.classList.remove('hidden');
                eye.textContent = "ğŸ‘ï¸";
                eye.title = "ç‚¹å‡»éšè—å¿«æ·é”®ä¿¡æ¯";
            } else {
                container.classList.add('hidden');
                eye.textContent = "ğŸ™ˆ";
                eye.title = "ç‚¹å‡»æ˜¾ç¤ºå¿«æ·é”®ä¿¡æ¯";
            }
        });
    }

    // è®¾ç½®é˜¶æ®µæ”¶èµ·/å±•å¼€åŠŸèƒ½
    function setupStageToggle() {
        document.getElementById('strategyStagesContainer').addEventListener('click', function (e) {
            if (e.target.classList.contains('toggle-stage-icon')) {
                toggleStageContent(e.target);
            }
        });
    }

    // åˆ‡æ¢é˜¶æ®µå†…å®¹æ˜¾ç¤º/éšè—
    function toggleStageContent(toggleIcon) {
        const stageElement = toggleIcon.closest('.strategy-stage');
        const contentElement = stageElement.querySelector('.stage-content');

        if (contentElement.classList.contains('collapsed')) {
            // å±•å¼€é˜¶æ®µå†…å®¹
            contentElement.classList.remove('collapsed');
            toggleIcon.classList.remove('closed');
            toggleIcon.classList.add('open');
            toggleIcon.textContent = 'âˆ’';
            toggleIcon.title = 'æ”¶èµ·é˜¶æ®µå†…å®¹';
        } else {
            // æ”¶èµ·é˜¶æ®µå†…å®¹
            contentElement.classList.add('collapsed');
            toggleIcon.classList.remove('open');
            toggleIcon.classList.add('closed');
            toggleIcon.textContent = '+';
            toggleIcon.title = 'å±•å¼€é˜¶æ®µå†…å®¹';
        }
    }

    // è®¾ç½®è¾“å…¥å‚æ•°éƒ¨åˆ†æ”¶èµ·/å±•å¼€åŠŸèƒ½
    function setupInputSectionToggle() {
        const toggleIcon = document.querySelector('.toggle-input-icon');
        const inputContent = document.querySelector('.input-content');

        if (toggleIcon && inputContent) {
            toggleIcon.addEventListener('click', function () {
                if (inputContent.classList.contains('collapsed')) {
                    // å±•å¼€å†…å®¹
                    inputContent.classList.remove('collapsed');
                    toggleIcon.classList.remove('closed');
                    toggleIcon.classList.add('open');
                    toggleIcon.textContent = 'âˆ’';
                    toggleIcon.title = 'æ”¶èµ·è¾“å…¥å‚æ•°';
                } else {
                    // æ”¶èµ·å†…å®¹
                    inputContent.classList.add('collapsed');
                    toggleIcon.classList.remove('open');
                    toggleIcon.classList.add('closed');
                    toggleIcon.textContent = '+';
                    toggleIcon.title = 'å±•å¼€è¾“å…¥å‚æ•°';
                }
            });
        }
    }

    // åŒæ­¥é˜¶æ®µå‚æ•°åˆ°åç»­é˜¶æ®µ - ä¿®å¤ç‰ˆï¼ˆåç§°ä¿®æ”¹æ—¶ä¿æŒæ¬¡æ•°ï¼‰
    function syncStageParameters(currentStageIndex) {
        const allStages = document.querySelectorAll('.strategy-stage');
        if (currentStageIndex >= allStages.length - 1) return; // å¦‚æœæ˜¯æœ€åä¸€ä¸ªé˜¶æ®µï¼Œä¸éœ€è¦åŒæ­¥

        const currentStage = allStages[currentStageIndex];

        // è·å–å½“å‰é˜¶æ®µçš„å€¼
        const basicFan = currentStage.querySelector('.basic-fan').value;
        const basicScore = currentStage.querySelector('.basic-score').value;

        // è·å–å½“å‰é˜¶æ®µçš„è‡ªå®šä¹‰æŠ¤èº«ç¬¦æ•°æ®
        const currentCustomParams = getStageCustomParamsData(currentStage);

        // åŒæ­¥åˆ°åç»­æ‰€æœ‰é˜¶æ®µ
        for (let i = currentStageIndex + 1; i < allStages.length; i++) {
            const targetStage = allStages[i];

            // åŒæ­¥åŸºç¡€ç•ªæ•°
            const targetBasicFan = targetStage.querySelector('.basic-fan');
            if (targetBasicFan) targetBasicFan.value = basicFan;

            // åŒæ­¥åŸºç¡€åˆ†æ•°
            const targetBasicScore = targetStage.querySelector('.basic-score');
            if (targetBasicScore) targetBasicScore.value = basicScore;

            // åŒæ­¥è‡ªå®šä¹‰æŠ¤èº«ç¬¦ï¼ˆä¿æŒç›®æ ‡é˜¶æ®µçš„æ¬¡æ•°ï¼‰
            const targetCustomParamsContainer = targetStage.querySelector('.stage-custom-params-container');
            if (targetCustomParamsContainer) {
                // è·å–ç›®æ ‡é˜¶æ®µç°æœ‰çš„è‡ªå®šä¹‰æŠ¤èº«ç¬¦æ•°æ®ï¼ˆä¿ç•™æ¬¡æ•°ï¼‰
                const targetCustomParams = getStageCustomParamsData(targetStage);

                // æ¸…ç©ºç›®æ ‡å®¹å™¨
                targetCustomParamsContainer.innerHTML = '';

                // é‡æ–°æ·»åŠ æ‰€æœ‰è‡ªå®šä¹‰æŠ¤èº«ç¬¦ï¼Œä½¿ç”¨ç›®æ ‡é˜¶æ®µçš„æ¬¡æ•°
                currentCustomParams.forEach((param, index) => {
                    // å¦‚æœç›®æ ‡é˜¶æ®µæœ‰å¯¹åº”ä½ç½®çš„æŠ¤èº«ç¬¦ï¼Œä½¿ç”¨ç›®æ ‡é˜¶æ®µçš„æ¬¡æ•°
                    // å¦åˆ™ä½¿ç”¨å½“å‰é˜¶æ®µçš„æ¬¡æ•°
                    const times = targetCustomParams[index] ? targetCustomParams[index].times : param.times;

                    addStageCustomParamToContainer(
                        targetCustomParamsContainer,
                        param.name,
                        param.value,
                        times,
                        false // ä¸è§¦å‘åŒæ­¥ï¼Œé¿å…å¾ªç¯
                    );
                });
            }
        }
    }
    // è·å–é˜¶æ®µè‡ªå®šä¹‰æŠ¤èº«ç¬¦æ•°æ®
    function getStageCustomParamsData(stageElement) {
        const container = stageElement.querySelector('.stage-custom-params-container');
        if (!container) return [];

        const customParams = [];
        const customParamGroups = container.querySelectorAll('.stage-custom-param-group');

        customParamGroups.forEach((group, index) => {
            const nameInput = group.querySelector('.stage-custom-param-name');
            const valueInput = group.querySelector('.stage-custom-param-value');
            const timesInput = group.querySelector('.stage-custom-param-times');

            if (nameInput && valueInput && timesInput) {
                customParams.push({
                    name: nameInput.value,
                    value: valueInput.value,
                    times: timesInput.value,
                    index: index
                });
            }
        });

        return customParams;
    }
    // ç»‘å®šè‡ªå®šä¹‰æŠ¤èº«ç¬¦äº‹ä»¶ - ä¿®å¤ç‰ˆï¼ˆè§¦å‘è‡ªå®šä¹‰æŠ¤èº«ç¬¦åŒæ­¥ï¼‰
    function bindCustomParamEvents(container) {
        const customParamGroups = container.querySelectorAll('.stage-custom-param-group');

        customParamGroups.forEach(group => {
            const nameInput = group.querySelector('.stage-custom-param-name');
            const valueInput = group.querySelector('.stage-custom-param-value');

            // ç§»é™¤å¯èƒ½é‡å¤çš„äº‹ä»¶ç›‘å¬å™¨
            [nameInput, valueInput].forEach(input => {
                // å…‹éš†å…ƒç´ å¹¶æ›¿æ¢ä»¥ç§»é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
                const newInput = input.cloneNode(true);
                input.parentNode.replaceChild(newInput, input);
            });

            // é‡æ–°è·å–å…ƒç´ å¼•ç”¨ï¼ˆåªè·å–åç§°å’Œæ•°å€¼è¾“å…¥æ¡†ï¼‰
            const newNameInput = group.querySelector('.stage-custom-param-name');
            const newValueInput = group.querySelector('.stage-custom-param-value');

            // ç›‘å¬åç§°å’Œæ•°å€¼è¾“å…¥å˜åŒ–ï¼Œè§¦å‘è‡ªå®šä¹‰æŠ¤èº«ç¬¦åŒæ­¥
            [newNameInput, newValueInput].forEach(input => {
                input.addEventListener('input', function() {
                    const stageElement = container.closest('.strategy-stage');
                    const allStages = Array.from(document.querySelectorAll('.strategy-stage'));
                    const currentStageIndex = allStages.indexOf(stageElement);
                    syncCustomParams(currentStageIndex);
                });
            });
        });
    }

    // è®¾ç½®é˜¶æ®µåŒæ­¥åŠŸèƒ½ - ä¿®å¤ç‰ˆï¼ˆåˆ†ç¦»åŸºç¡€å‚æ•°å’Œè‡ªå®šä¹‰æŠ¤èº«ç¬¦åŒæ­¥ï¼‰
    function setupStageSync() {
        const stagesContainer = document.getElementById('strategyStagesContainer');

        // ç›‘å¬åŸºç¡€ç•ªæ•°å’ŒåŸºç¡€åˆ†æ•°çš„å˜åŒ– - åªåŒæ­¥åŸºç¡€å‚æ•°
        stagesContainer.addEventListener('input', function(e) {
            if (e.target.classList.contains('basic-fan') || e.target.classList.contains('basic-score')) {
                const stageElement = e.target.closest('.strategy-stage');
                const allStages = Array.from(document.querySelectorAll('.strategy-stage'));
                const currentStageIndex = allStages.indexOf(stageElement);
                syncBasicParameters(currentStageIndex);
            }
        });

        // ç›‘å¬è‡ªå®šä¹‰æŠ¤èº«ç¬¦çš„å˜åŒ–ï¼ˆåªç›‘å¬åç§°å’Œæ•°å€¼ï¼Œä¸ç›‘å¬æ¬¡æ•°ï¼‰- åªåŒæ­¥è‡ªå®šä¹‰æŠ¤èº«ç¬¦
        stagesContainer.addEventListener('input', function(e) {
            if (e.target.classList.contains('stage-custom-param-name') ||
                e.target.classList.contains('stage-custom-param-value')) {

                const stageElement = e.target.closest('.strategy-stage');
                const allStages = Array.from(document.querySelectorAll('.strategy-stage'));
                const currentStageIndex = allStages.indexOf(stageElement);
                syncCustomParams(currentStageIndex);
            }
        });

        // ç›‘å¬æ·»åŠ è‡ªå®šä¹‰æŠ¤èº«ç¬¦æŒ‰é’®çš„ç‚¹å‡»
        stagesContainer.addEventListener('click', function(e) {
            if (e.target.classList.contains('add-stage-custom-param-btn') ||
                e.target.closest('.add-stage-custom-param-btn')) {
                // æ·»åŠ è‡ªå®šä¹‰æŠ¤èº«ç¬¦åä¼šè‡ªåŠ¨è§¦å‘åŒæ­¥ï¼Œä¸éœ€è¦é¢å¤–å¤„ç†
            }
        });
    }

    // åŒæ­¥åŸºç¡€å‚æ•°åˆ°åç»­é˜¶æ®µï¼ˆä¸å½±å“è‡ªå®šä¹‰æŠ¤èº«ç¬¦ï¼‰
    function syncBasicParameters(currentStageIndex) {
        const allStages = document.querySelectorAll('.strategy-stage');
        if (currentStageIndex >= allStages.length - 1) return; // å¦‚æœæ˜¯æœ€åä¸€ä¸ªé˜¶æ®µï¼Œä¸éœ€è¦åŒæ­¥

        const currentStage = allStages[currentStageIndex];

        // è·å–å½“å‰é˜¶æ®µçš„åŸºç¡€å‚æ•°å€¼
        const basicFan = currentStage.querySelector('.basic-fan').value;
        const basicScore = currentStage.querySelector('.basic-score').value;

        // åŒæ­¥åˆ°åç»­æ‰€æœ‰é˜¶æ®µ
        for (let i = currentStageIndex + 1; i < allStages.length; i++) {
            const targetStage = allStages[i];

            // åŒæ­¥åŸºç¡€ç•ªæ•°
            const targetBasicFan = targetStage.querySelector('.basic-fan');
            if (targetBasicFan) targetBasicFan.value = basicFan;

            // åŒæ­¥åŸºç¡€åˆ†æ•°
            const targetBasicScore = targetStage.querySelector('.basic-score');
            if (targetBasicScore) targetBasicScore.value = basicScore;
        }
    }

    // åŒæ­¥è‡ªå®šä¹‰æŠ¤èº«ç¬¦åˆ°åç»­é˜¶æ®µ
    function syncCustomParams(currentStageIndex) {
        const allStages = document.querySelectorAll('.strategy-stage');
        if (currentStageIndex >= allStages.length - 1) return; // å¦‚æœæ˜¯æœ€åä¸€ä¸ªé˜¶æ®µï¼Œä¸éœ€è¦åŒæ­¥

        const currentStage = allStages[currentStageIndex];

        // è·å–å½“å‰é˜¶æ®µçš„è‡ªå®šä¹‰æŠ¤èº«ç¬¦æ•°æ®
        const currentCustomParams = getStageCustomParamsData(currentStage);

        // åŒæ­¥åˆ°åç»­æ‰€æœ‰é˜¶æ®µ
        for (let i = currentStageIndex + 1; i < allStages.length; i++) {
            const targetStage = allStages[i];

            // åŒæ­¥è‡ªå®šä¹‰æŠ¤èº«ç¬¦
            const targetCustomParamsContainer = targetStage.querySelector('.stage-custom-params-container');
            if (targetCustomParamsContainer) {
                // è·å–ç›®æ ‡é˜¶æ®µç°æœ‰çš„è‡ªå®šä¹‰æŠ¤èº«ç¬¦æ•°æ®ï¼ˆä¿ç•™æ¬¡æ•°ï¼‰
                const targetCustomParams = getStageCustomParamsData(targetStage);
                const targetTimesMap = {};

                // åˆ›å»ºç›®æ ‡é˜¶æ®µçš„æ¬¡æ•°æ˜ å°„è¡¨
                targetCustomParams.forEach(param => {
                    targetTimesMap[param.name] = param.times;
                });

                // æ¸…ç©ºç›®æ ‡å®¹å™¨
                targetCustomParamsContainer.innerHTML = '';

                // é‡æ–°æ·»åŠ æ‰€æœ‰è‡ªå®šä¹‰æŠ¤èº«ç¬¦ï¼Œä½¿ç”¨ç›®æ ‡é˜¶æ®µçš„æ¬¡æ•°
                currentCustomParams.forEach((param, index) => {
                    // å¦‚æœç›®æ ‡é˜¶æ®µæœ‰ç›¸åŒåç§°çš„æŠ¤èº«ç¬¦ï¼Œä½¿ç”¨ç›®æ ‡é˜¶æ®µçš„æ¬¡æ•°
                    // å¦åˆ™ä½¿ç”¨å½“å‰é˜¶æ®µçš„æ¬¡æ•°
                    const times = targetTimesMap[param.name] || param.times;

                    addStageCustomParamToContainer(
                        targetCustomParamsContainer,
                        param.name,
                        param.value,
                        times,
                        false // ä¸è§¦å‘åŒæ­¥ï¼Œé¿å…å¾ªç¯
                    );
                });
            }
        }
    }
    // æ ¼å¼åŒ–æ•°å€¼æ˜¾ç¤º - æ ¹æ®æ•°å€¼å¤§å°é€‰æ‹©å•ä½æˆ–ç§‘å­¦è®¡æ•°æ³•
    function formatValueDisplay(value) {
        // å¦‚æœå€¼å°äº1e300ï¼Œç”¨å•ä½æ˜¾ç¤º
        if (value.lessThan(new Decimal('1e300'))) {
            return formatWithUnits(value);
        } else {
            // å¦‚æœå€¼å¤§äºç­‰äº1e300ï¼Œç”¨ç§‘å­¦è®¡æ•°æ³•æ˜¾ç¤ºï¼Œä¿ç•™6ä½å°æ•°
            return value.toExponential(6);
        }
    }

    // ä½¿ç”¨å•ä½æ ¼å¼åŒ–æ•°å€¼ - æ¯48ä½æ›¿æ¢ä¸€ä¸ª"æ"
    function formatWithUnits(value) {
        // å®šä¹‰å•ä½å¯¹ç…§è¡¨ï¼ˆä»å¤§åˆ°å°ï¼‰
        const units = [
            { name: "æ", magnitude: 48 },
            { name: "è½½", magnitude: 44 },
            { name: "æ­£", magnitude: 40 },
            { name: "æ¶§", magnitude: 36 },
            { name: "æ²Ÿ", magnitude: 32 },
            { name: "ç©°", magnitude: 28 },
            { name: "ç§­", magnitude: 24 },
            { name: "å“", magnitude: 20 },
            { name: "äº¬", magnitude: 16 },
            { name: "å…†", magnitude: 12 },
            { name: "äº¿", magnitude: 8 },
            { name: "ä¸‡", magnitude: 4 }
        ];

        // è®¡ç®—æ•°å€¼çš„æ•°é‡çº§
        const magnitude = value.log(10);

        // å¦‚æœæ•°å€¼å°äº1ä¸‡ï¼Œç›´æ¥æ˜¾ç¤º
        if (magnitude < 4) {
            return value.toDecimalPlaces(2).toString();
        }

        // è®¡ç®—éœ€è¦å¤šå°‘ä¸ª"æ"å•ä½
        let jiCount = 0;
        let remainingMagnitude = magnitude;

        // æ¯48ä½æ·»åŠ ä¸€ä¸ª"æ"
        while (remainingMagnitude >= 48) {
            jiCount++;
            remainingMagnitude -= 48;
        }

        // æ‰¾åˆ°é€‚åˆçš„å•ä½
        let unit = null;
        for (let u of units) {
            if (remainingMagnitude >= u.magnitude) {
                unit = u;
                break;
            }
        }

        // è®¡ç®—æ˜¾ç¤ºå€¼
        let displayValue = value;
        let unitStr = "";

        // å¤„ç†"æ"å•ä½
        if (jiCount > 0) {
            for (let i = 0; i < jiCount; i++) {
                displayValue = displayValue.dividedBy(Decimal.pow(10, 48));
                unitStr += "æ";
            }
        }

        // å¤„ç†å…¶ä»–å•ä½
        if (unit) {
            displayValue = displayValue.dividedBy(Decimal.pow(10, unit.magnitude));
            unitStr = unit.name + unitStr;
        }

        // ä¿ç•™ä¸¤ä½å°æ•°
        const formattedValue = displayValue.toDecimalPlaces(2).toString();

        return formattedValue + unitStr;
    }
    // åˆå§‹åŒ–å‡½æ•°
    function init() {
        // äº‹ä»¶ç›‘å¬
        document.getElementById('addCustomParam').addEventListener('click', addCustomParam);
        document.getElementById('addStageBtn').addEventListener('click', () => addStrategyStage());

        // é¢„è®¾ç­–ç•¥æŒ‰é’®äº‹ä»¶ç›‘å¬
        document.getElementById('twoInflationBtn').addEventListener('click', applyTwoInflationStrategy);
        document.getElementById('singleDyHackerBtn').addEventListener('click', applySingleDyHackerStrategy);
        document.getElementById('inflationDyFzHackerBtn').addEventListener('click', applyInflationDyFzHackerStrategy);

        // å•æ¬¡è®¡ç®—æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('calculateBtn').addEventListener('click', function () {
            try {
                // è·å–è¾“å…¥å€¼ï¼Œå¦‚æœä¸ºç©ºåˆ™é»˜è®¤ä¸º0
                const curLevel = parseInt(document.getElementById('curLevel').value);
                const dy = parseValue(document.getElementById('dy').value);
                const fz = parseValue(document.getElementById('fz').value);
                const yg = parseValue(document.getElementById('yg').value);
                const eat_fog = parseInt(getValueOrDefault(document.getElementById('eat_fog').value, 0));
                const lose_fz = parseInt(getValueOrDefault(document.getElementById('lose_fz').value, 0));
                const lose_yg = parseInt(getValueOrDefault(document.getElementById('lose_yg').value, 0));
                const dy_type = document.getElementById('dy_type').value;
                const fz_type = document.getElementById('fz_type').value;
                const yg_type = document.getElementById('yg_type').value;
                const basicFan = parseInt(document.getElementById('basicFan').value);
                const basicScore = parseInt(document.getElementById('basicScore').value);
                const dy_times = parseInt(document.getElementById('dy_times').value);
                const fz_times = parseInt(document.getElementById('fz_times').value);
                const yg_times = parseInt(document.getElementById('yg_times').value);

                // è·å–è‡ªå®šä¹‰æŠ¤èº«ç¬¦å‚æ•°
                const customizedParams = getCustomizedParams();

                // è·å–æŠ¤èº«ç¬¦å¯ç”¨çŠ¶æ€
                const talismanEnabled = getTalismanEnabledStates();

                //å•é˜¶æ®µè®¡ç®—æ—¶hasNextStageæ’ä¸ºtrue
                hasNextStage = true;

                // æ‰§è¡Œè®¡ç®—
                const result = executeCurrentStage(
                    curLevel, 0, 0, dy, fz, yg,
                    lose_fz, lose_yg, eat_fog,
                    dy_type, fz_type, yg_type,
                    basicFan, basicScore,
                    dy_times, fz_times, yg_times,
                    customizedParams,
                    "å½“å‰",
                    talismanEnabled
                );

                // æ›´æ–°è¾“å‡ºæ—¥å¿—
                document.getElementById('outputLog').innerHTML = result.outputLines.map(line =>
                    `<div class="output-line">${line}</div>`).join(
                    '');

                // æ˜¾ç¤ºç»“æœ
                document.getElementById('resultText').textContent = `EX${result.nextLevel - 1}`;
            } catch (error) {
                document.getElementById('outputLog').innerHTML =
                    `<div class="output-line highlight">è¾“å…¥æ ¼å¼é”™è¯¯ï¼š${error.message}</div>`;
                document.getElementById('resultText').textContent = "è®¡ç®—å¤±è´¥";
            }
        });

        // ç­–ç•¥è®¡ç®—æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('calculateStrategyBtn').addEventListener('click', function () {
            try {
                // é‡ç½® hasNextStage
                hasNextStage = true;
                // è·å–åˆå§‹å‚æ•°
                const curLevel = parseInt(document.getElementById('curLevel').value);
                let dy = parseValue(document.getElementById('dy').value);
                let fz = parseValue(document.getElementById('fz').value);
                let yg = parseValue(document.getElementById('yg').value);

                // è·å–æ‰€æœ‰é˜¶æ®µé…ç½®
                const stages = getAllStages();

                let currentLevel = curLevel;
                let allOutputLines = [];

                // å¦‚æœæ²¡æœ‰é˜¶æ®µï¼Œä½¿ç”¨é»˜è®¤å•é˜¶æ®µè®¡ç®—
                if (stages.length === 0) {
                    allOutputLines.push(`<span class="highlight">æœªé…ç½®ç­–ç•¥é˜¶æ®µï¼Œä½¿ç”¨é»˜è®¤è®¡ç®—</span>`);
                    const talismanEnabled = getTalismanEnabledStates();
                    const result = executeCurrentStage(
                        currentLevel, 0, 0, dy, fz, yg,
                        0, 0, 0,
                        "æ™®é€šç›—å°", "è†¨èƒ€è´Ÿé‡", "æ™®é€šæœˆå…‰",
                        23, 1111100,
                        6, 3, 5,
                        [],
                        "é»˜è®¤é˜¶æ®µ",
                        talismanEnabled
                    );

                    allOutputLines = allOutputLines.concat(result.outputLines);
                    currentLevel = result.nextLevel;
                    dy = result.dy;
                    fz = result.fz;
                    yg = result.yg;
                } else {
                    // æŒ‰é¡ºåºæ‰§è¡Œæ¯ä¸ªé˜¶æ®µ
                    for (let i = 0; i < stages.length; i++) {
                        const stage = stages[i];

                        // è·å–ä¸‹ä¸€é˜¶æ®µçš„å®é™…å¼€å§‹å…³å¡ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
                        const nextStageActualLevel = i + 1 < stages.length ? stages[i + 1].actualLevel : 0;

                        const talismanEnabled = {
                            dy: stage.dy_enabled,
                            fz: stage.fz_enabled,
                            yg: stage.yg_enabled
                        };

                        // å¯¹äºé˜¶æ®µ1ï¼Œä½¿ç”¨é¡¶éƒ¨è¾“å…¥çš„åˆå§‹å€¼
                        // å¯¹äºåç»­é˜¶æ®µï¼Œæ ¹æ®æŠ¤èº«ç¬¦å¯ç”¨çŠ¶æ€ç¡®å®šåˆå§‹å€¼
                        if (i > 0) {
                            // å¦‚æœå½“å‰é˜¶æ®µå¯ç”¨äº†æŸä¸ªæŠ¤èº«ç¬¦ï¼Œä½†ä¸Šä¸€ä¸ªé˜¶æ®µæ²¡æœ‰å¯ç”¨ï¼Œåˆ™å°†è¯¥æŠ¤èº«ç¬¦çš„å€¼è®¾ä¸º1
                            if (stage.dy_enabled && !stages[i - 1].dy_enabled) {
                                dy = new Decimal(1);
                                talismanEnabled.dy_first = true;
                                allOutputLines.push(`<span class="highlight">ç›—å°æŠ¤èº«ç¬¦å¼€å§‹å¯ç”¨</span>`);
                            }
                            if (stage.fz_enabled && !stages[i - 1].fz_enabled) {
                                fz = new Decimal(1);
                                talismanEnabled.fz_first = true;
                                allOutputLines.push(`<span class="highlight">è´Ÿé‡æŠ¤èº«ç¬¦å¼€å§‹å¯ç”¨</span>`);
                            }
                            if (stage.yg_enabled && !stages[i - 1].yg_enabled) {
                                yg = new Decimal(1);
                                talismanEnabled.yg_first = true;
                                allOutputLines.push(`<span class="highlight">æœˆå…‰æŠ¤èº«ç¬¦å¼€å§‹å¯ç”¨</span>`);
                            }
                        }

                        const result = executeCurrentStage(
                            currentLevel, stage.actualLevel, nextStageActualLevel, dy, fz, yg,
                            stage.lose_fz, stage.lose_yg, stage.eat_fog,
                            stage.dy_type, stage.fz_type, stage.yg_type,
                            stage.basicFan, stage.basicScore,
                            stage.dy_times, stage.fz_times, stage.yg_times,
                            stage.customizedParams, // ä½¿ç”¨é˜¶æ®µçš„è‡ªå®šä¹‰æŠ¤èº«ç¬¦
                            stage.name,
                            talismanEnabled
                        );

                        allOutputLines = allOutputLines.concat(result.outputLines);
                        currentLevel = result.nextLevel;
                        dy = result.dy;
                        fz = result.fz;
                        yg = result.yg;

                        // å¦‚æœå·²ç»è¾¾åˆ°æé™ï¼Œæå‰ç»“æŸ
                        if (currentLevel >= REQUIRED_SCORE.length) {
                            break;
                        }
                    }
                }

                // æ›´æ–°è¾“å‡ºæ—¥å¿—
                document.getElementById('outputLog').innerHTML = allOutputLines.map(line =>
                    `<div class="output-line">${line}</div>`).join('');

                // æ˜¾ç¤ºç»“æœ
                document.getElementById('resultText').textContent = `EX${currentLevel - 1}`;

            } catch (error) {
                document.getElementById('outputLog').innerHTML =
                    `<div class="output-line highlight">è¾“å…¥æ ¼å¼é”™è¯¯ï¼š${error.message}</div>`;
                document.getElementById('resultText').textContent = "è®¡ç®—å¤±è´¥";
            }
        });

        // è®¾ç½®é¡¶éƒ¨å‚æ•°çš„é»˜è®¤å€¼
        document.getElementById('curLevel').value = "1";
        document.getElementById('dy').value = "144.61";
        document.getElementById('fz').value = "378.36";
        document.getElementById('yg').value = "56.02";
        document.getElementById('dy_type').value = "å¡ç»´è†¨èƒ€ç›—å°";
        document.getElementById('fz_type').value = "è†¨èƒ€è´Ÿé‡";
        document.getElementById('yg_type').value = "æ™®é€šæœˆå…‰";
        document.getElementById('basicFan').value = "19";
        document.getElementById('basicScore').value = "38";
        document.getElementById('dy_times').value = "2";
        document.getElementById('fz_times').value = "2";
        document.getElementById('yg_times').value = "1";
        document.getElementById('eat_fog').value = "0";
        document.getElementById('lose_fz').value = "0";
        document.getElementById('lose_yg').value = "0";

        // æ·»åŠ é»˜è®¤é˜¶æ®µï¼Œä½¿ç”¨é¡¶éƒ¨å‚æ•°çš„é»˜è®¤å€¼
        addStrategyStage();

        // åœ¨initå‡½æ•°ä¸­æ·»åŠ çœ¼ç›å›¾æ ‡çš„ç‚¹å‡»äº‹ä»¶ç›‘å¬
        document.getElementById('toggleMagnitudeTable').addEventListener('click', function () {
            const table = document.getElementById('magnitudeTable');
            const eye = document.getElementById('toggleMagnitudeTable');

            if (table.classList.contains('hidden')) {
                // æ˜¾ç¤ºè¡¨æ ¼
                table.classList.remove('hidden');
                eye.classList.remove('closed');
                eye.classList.add('open');
                eye.title = "ç‚¹å‡»éšè—è¡¨æ ¼";
                eye.textContent = "ğŸ‘ï¸"; // ççœ¼å›¾æ ‡
            } else {
                // éšè—è¡¨æ ¼
                table.classList.add('hidden');
                eye.classList.remove('open');
                eye.classList.add('closed');
                eye.title = "ç‚¹å‡»æ˜¾ç¤ºè¡¨æ ¼";
                eye.textContent = "ğŸ™ˆ"; // é—­çœ¼å›¾æ ‡
            }
        });

        // è®¾ç½®æŠ¤èº«ç¬¦å¼€å…³ç›‘å¬
        setupTalismanToggles();
        setupStageTalismanToggles();

        // è®¾ç½®æŠ¤èº«ç¬¦å†…å®¹çš„åˆå§‹æ˜¾ç¤ºçŠ¶æ€
        const dyEnabled = document.getElementById('dyTalismanEnabled').checked;
        const fzEnabled = document.getElementById('fzTalismanEnabled').checked;
        const ygEnabled = document.getElementById('ygTalismanEnabled').checked;

        updateTopTalismanContent('dy', dyEnabled);
        updateTopTalismanContent('fz', fzEnabled);
        updateTopTalismanContent('yg', ygEnabled);

        // åˆå§‹åŒ–å…³å¡åˆ†æ•°è¡¨æ ¼
        initScoreTable();
        setupScoreTableToggle();

        // åˆå§‹åŒ–å•ä½è½¬æ¢å™¨
        setupUnitConverter();

        // åˆå§‹åŒ–å¿«æ·é”®æ¨¡å—
        setupShortcutModuleToggle();

        // è®¾ç½®é˜¶æ®µæ”¶èµ·/å±•å¼€åŠŸèƒ½
        setupStageToggle();

        // è®¾ç½®è¾“å…¥å‚æ•°éƒ¨åˆ†æ”¶èµ·/å±•å¼€åŠŸèƒ½
        setupInputSectionToggle();

        // è®¾ç½®é˜¶æ®µåŒæ­¥åŠŸèƒ½
        setupStageSync();
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>